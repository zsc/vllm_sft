<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>ç¬¬ 7 ç« ï¼šè¯„ä¼°ä½“ç³»è®¾è®¡</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>ç›®å½•</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="æœç´¢..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">è§†è§‰è¯­è¨€æ¨¡å‹ï¼ˆVLMï¼‰çš„ç›‘ç£å¾®è°ƒä¸å¼ºåŒ–å­¦ä¹ å®æˆ˜æ•™ç¨‹</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 1 ç« ï¼šVLM æ¶æ„ä¸åŸç†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 2 ç« ï¼šæ•°æ®å‡†å¤‡ä¸é¢„å¤„ç†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 3 ç« ï¼šSFT è®­ç»ƒç­–ç•¥</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 4 ç« ï¼šåˆ†å¸ƒå¼è®­ç»ƒä¸ä¼˜åŒ–</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 5 ç« ï¼šRLHF åŸºç¡€ä¸å®ç°</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 6 ç« ï¼šç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDPOï¼‰</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 7 ç« ï¼šè¯„ä¼°ä½“ç³»è®¾è®¡</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 8 ç« ï¼šæ¨¡å‹éƒ¨ç½²ä¸æœåŠ¡åŒ–</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 9 ç« ï¼šCUDA OOM è°ƒè¯•å®Œå…¨æŒ‡å—</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 10 ç« ï¼šè®­ç»ƒå´©æºƒä¸ NaN é—®é¢˜</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 11 ç« ï¼šè®­ç»ƒé€Ÿåº¦ä¼˜åŒ–å®æˆ˜</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ç¬¬ 12 ç« ï¼šå¤šæœºå¤šå¡è°ƒè¯•åœ°ç‹±</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="7">ç¬¬ 7 ç« ï¼šè¯„ä¼°ä½“ç³»è®¾è®¡</h1>
<p>è¯„ä¼°æ˜¯ VLM å¼€å‘å‘¨æœŸä¸­æœ€å…³é”®å´åˆæœ€å®¹æ˜“è¢«å¿½è§†çš„ç¯èŠ‚ã€‚ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„è¯„ä¼°ä½“ç³»ä¸ä»…èƒ½å‡†ç¡®è¡¡é‡æ¨¡å‹æ€§èƒ½ï¼Œæ›´èƒ½æŒ‡å¯¼è®­ç»ƒä¼˜åŒ–æ–¹å‘ã€å‘ç°æ½œåœ¨é—®é¢˜ã€æ”¯æ’‘äº§å“å†³ç­–ã€‚æœ¬ç« å°†ä»åŸºå‡†æµ‹è¯•é€‰æ‹©ã€æŒ‡æ ‡è®¾è®¡ã€äººå·¥è¯„ä¼°ç»„ç»‡åˆ°åœ¨çº¿ A/B æµ‹è¯•ï¼Œæ„å»ºä¸€å¥—å®Œæ•´çš„ VLM è¯„ä¼°æ–¹æ³•è®ºã€‚æˆ‘ä»¬å°†ç‰¹åˆ«å…³æ³¨å¤šæ¨¡æ€ç‰¹æœ‰çš„è¯„ä¼°æŒ‘æˆ˜ï¼Œå¦‚å¹»è§‰æ£€æµ‹ã€è·¨æ¨¡æ€ä¸€è‡´æ€§éªŒè¯ç­‰å®é™…é—®é¢˜ã€‚</p>
<h2 id="71">7.1 å¤šæ¨¡æ€åŸºå‡†æµ‹è¯•ä»‹ç»</h2>
<h3 id="711">7.1.1 ä¸»æµåŸºå‡†æµ‹è¯•æ¦‚è§ˆ</h3>
<p>VLM çš„è¯„ä¼°åŸºå‡†å¯åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p>
<p><strong>é€šç”¨èƒ½åŠ›è¯„ä¼°åŸºå‡†</strong></p>
<div class="codehilite"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     åŸºå‡†åç§°     â”‚   ä»»åŠ¡ç±»å‹    â”‚  æ•°æ®è§„æ¨¡   â”‚    ç‰¹ç‚¹      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MMBench         â”‚ å¤šé€‰é¢˜       â”‚ 3000é¢˜      â”‚ å¾ªç¯è¯„ä¼°     â”‚
â”‚ SEED-Bench      â”‚ å¤šé€‰é¢˜       â”‚ 19Ké¢˜       â”‚ å¤šç»´åº¦è¦†ç›–   â”‚
â”‚ MME             â”‚ æ˜¯/å¦åˆ¤æ–­    â”‚ 14ä¸ªå­ä»»åŠ¡  â”‚ æ„ŸçŸ¥+è®¤çŸ¥    â”‚
â”‚ MMMU            â”‚ å¤šé€‰é¢˜       â”‚ 11.5Ké¢˜     â”‚ å­¦ç§‘çŸ¥è¯†     â”‚
â”‚ MathVista       â”‚ æ•°å­¦æ¨ç†     â”‚ 6Ké¢˜        â”‚ æ•°å­¦å›¾è¡¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>é¢†åŸŸç‰¹å®šè¯„ä¼°</strong></p>
<ol>
<li>
<p><strong>OCR ç›¸å…³</strong>
   - TextVQAï¼šåœºæ™¯æ–‡å­—ç†è§£
   - OCRBenchï¼šç»¼åˆ OCR èƒ½åŠ›
   - DocVQAï¼šæ–‡æ¡£ç†è§£</p>
</li>
<li>
<p><strong>è§†è§‰é—®ç­”ï¼ˆVQAï¼‰</strong>
   - VQAv2ï¼šé€šç”¨è§†è§‰é—®ç­”
   - GQAï¼šç»„åˆæ¨ç†
   - OK-VQAï¼šéœ€è¦å¤–éƒ¨çŸ¥è¯†</p>
</li>
<li>
<p><strong>å›¾åƒæè¿°ï¼ˆCaptionï¼‰</strong>
   - COCO Captionï¼šé€šç”¨åœºæ™¯æè¿°
   - NoCapsï¼šæ–°ç‰©ä½“æè¿°
   - TextCapsï¼šåŒ…å«æ–‡å­—çš„å›¾åƒæè¿°</p>
</li>
</ol>
<h3 id="712">7.1.2 åŸºå‡†æµ‹è¯•çš„é€‰æ‹©ç­–ç•¥</h3>
<p>é€‰æ‹©åˆé€‚çš„è¯„ä¼°åŸºå‡†éœ€è¦è€ƒè™‘å¤šä¸ªç»´åº¦ï¼š</p>
<div class="codehilite"><pre><span></span><code>è¯„ä¼°ç»´åº¦çŸ©é˜µï¼š
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         åº”ç”¨åœºæ™¯éœ€æ±‚            â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚  å¯¹è¯ â”‚ OCR â”‚ æ¨ç† â”‚ åˆ›ä½œ    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚åŸºç¡€èƒ½åŠ› â”‚  âœ“    â”‚     â”‚      â”‚          â”‚ â†’ MMBench, SEED
â”‚ä¸“ä¸šçŸ¥è¯† â”‚       â”‚     â”‚  âœ“   â”‚          â”‚ â†’ MMMU, MathVista  
â”‚æ–‡å­—è¯†åˆ« â”‚       â”‚  âœ“  â”‚      â”‚          â”‚ â†’ TextVQA, OCRBench
â”‚å†…å®¹ç”Ÿæˆ â”‚       â”‚     â”‚      â”‚    âœ“     â”‚ â†’ COCO Caption
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<p><strong>é€‰æ‹©åŸåˆ™ï¼š</strong></p>
<ol>
<li><strong>è¦†ç›–æ€§åŸåˆ™</strong>ï¼šè‡³å°‘åŒ…å« 2-3 ä¸ªé€šç”¨åŸºå‡† + 2-3 ä¸ªé¢†åŸŸåŸºå‡†</li>
<li><strong>ä»£è¡¨æ€§åŸåˆ™</strong>ï¼šé€‰æ‹©ç¤¾åŒºè®¤å¯åº¦é«˜ã€æ›´æ–°ç»´æŠ¤å¥½çš„åŸºå‡†</li>
<li><strong>å¯æ¯”æ€§åŸåˆ™</strong>ï¼šé€‰æ‹©æœ‰å……åˆ† baseline ç»“æœçš„åŸºå‡†</li>
<li><strong>æ•ˆç‡åŸåˆ™</strong>ï¼šå¹³è¡¡è¯„ä¼°å…¨é¢æ€§å’Œè®¡ç®—æˆæœ¬</li>
</ol>
<h3 id="713">7.1.3 è¯„ä¼°æ•°æ®æ³„éœ²é—®é¢˜</h3>
<p>æ•°æ®æ³„éœ²æ˜¯å½“å‰ VLM è¯„ä¼°é¢ä¸´çš„ä¸¥é‡é—®é¢˜ï¼š</p>
<p><strong>æ³„éœ²æ£€æµ‹æ–¹æ³•ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ç¤ºä¾‹ï¼šæ£€æµ‹è®­ç»ƒæ•°æ®ä¸æµ‹è¯•é›†çš„é‡å </span>
<span class="k">def</span> <span class="nf">detect_data_leakage</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">):</span>
    <span class="c1"># 1. å›¾åƒçº§åˆ«æ£€æµ‹ï¼ˆæ„ŸçŸ¥å“ˆå¸Œï¼‰</span>
    <span class="n">train_hashes</span> <span class="o">=</span> <span class="n">compute_perceptual_hashes</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
    <span class="n">test_hashes</span> <span class="o">=</span> <span class="n">compute_perceptual_hashes</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
    <span class="n">image_overlap</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_hashes</span> <span class="o">&amp;</span> <span class="n">test_hashes</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_hashes</span><span class="p">)</span>

    <span class="c1"># 2. æ–‡æœ¬çº§åˆ«æ£€æµ‹ï¼ˆn-gram é‡å ï¼‰</span>
    <span class="n">train_ngrams</span> <span class="o">=</span> <span class="n">extract_ngrams</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">texts</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">test_ngrams</span> <span class="o">=</span> <span class="n">extract_ngrams</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">texts</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">text_overlap</span> <span class="o">=</span> <span class="n">jaccard_similarity</span><span class="p">(</span><span class="n">train_ngrams</span><span class="p">,</span> <span class="n">test_ngrams</span><span class="p">)</span>

    <span class="c1"># 3. è¯­ä¹‰çº§åˆ«æ£€æµ‹ï¼ˆembedding ç›¸ä¼¼åº¦ï¼‰</span>
    <span class="n">semantic_sim</span> <span class="o">=</span> <span class="n">compute_semantic_similarity</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;image_overlap&#39;</span><span class="p">:</span> <span class="n">image_overlap</span><span class="p">,</span>
        <span class="s1">&#39;text_overlap&#39;</span><span class="p">:</span> <span class="n">text_overlap</span><span class="p">,</span>
        <span class="s1">&#39;semantic_similarity&#39;</span><span class="p">:</span> <span class="n">semantic_sim</span>
    <span class="p">}</span>
</code></pre></div>

<p><strong>é˜²æ³„éœ²ç­–ç•¥ï¼š</strong></p>
<ol>
<li><strong>æ—¶é—´åˆ‡åˆ†</strong>ï¼šä½¿ç”¨æ¨¡å‹è®­ç»ƒåå‘å¸ƒçš„æµ‹è¯•é›†</li>
<li><strong>ç§æœ‰æµ‹è¯•é›†</strong>ï¼šç»´æŠ¤ä¸å…¬å¼€çš„è¯„ä¼°æ•°æ®</li>
<li><strong>åŠ¨æ€ç”Ÿæˆ</strong>ï¼šå®æ—¶ç”Ÿæˆè¯„ä¼°æ ·æœ¬</li>
<li><strong>å¯¹æŠ—æ ·æœ¬</strong>ï¼šåŠ å…¥è½»å¾®æ‰°åŠ¨æ£€æµ‹è®°å¿†</li>
</ol>
<h2 id="72">7.2 è‡ªåŠ¨è¯„ä¼°æŒ‡æ ‡è®¾è®¡</h2>
<h3 id="721">7.2.1 ä¼ ç»ŸæŒ‡æ ‡çš„å±€é™æ€§</h3>
<p>ä¼ ç»Ÿ NLP æŒ‡æ ‡åœ¨ VLM è¯„ä¼°ä¸­å­˜åœ¨æ˜æ˜¾ä¸è¶³ï¼š</p>
<div class="codehilite"><pre><span></span><code>é—®é¢˜ç¤ºä¾‹ï¼š
è¾“å…¥å›¾åƒï¼š[ä¸€åªæ£•è‰²çš„ç‹—åœ¨è‰åœ°ä¸Šå¥”è·‘]
æ¨¡å‹è¾“å‡ºï¼š&quot;ä¸€åªé‡‘æ¯›çŠ¬åœ¨ç»¿è‰²è‰åªä¸Šè·‘æ­¥&quot;
å‚è€ƒç­”æ¡ˆï¼š&quot;ä¸€åªæ£•è‰²çš„ç‹—åœ¨è‰åœ°ä¸Šå¥”è·‘&quot;

BLEU-4: 0.31 ï¼ˆä½åˆ†ï¼Œä½†è¯­ä¹‰æ­£ç¡®ï¼‰
äººç±»è¯„åˆ†ï¼š4.5/5 ï¼ˆé«˜åˆ†ï¼Œè®¤ä¸ºæè¿°å‡†ç¡®ï¼‰

â†’ æŒ‡æ ‡ä¸äººç±»åˆ¤æ–­ä¸¥é‡ä¸ä¸€è‡´
</code></pre></div>

<p><strong>å±€é™æ€§åˆ†æï¼š</strong></p>
<ol>
<li><strong>è¯­ä¹‰ç­‰ä»·æ€§</strong>ï¼šæ— æ³•è¯†åˆ«åŒä¹‰è¡¨è¾¾</li>
<li><strong>æ¨¡æ€å¯¹é½</strong>ï¼šå¿½ç•¥è§†è§‰ä¿¡æ¯çš„å‡†ç¡®æ€§</li>
<li><strong>éƒ¨åˆ†æ­£ç¡®æ€§</strong>ï¼šæ— æ³•è¯„ä¼°éƒ¨åˆ†æ­£ç¡®çš„ç­”æ¡ˆ</li>
<li><strong>åˆ›é€ æ€§æƒ©ç½š</strong>ï¼šå¯¹åˆç†ä½†ä¸åŒçš„è¡¨è¾¾ç»™äºˆä½åˆ†</li>
</ol>
<h3 id="722">7.2.2 åŸºäºæ¨¡å‹çš„è¯„ä¼°</h3>
<p>ä½¿ç”¨å¼ºå¤§çš„è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ GPT-4Vï¼‰ä½œä¸ºè‡ªåŠ¨è¯„åˆ¤è€…ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># GPT-4V è¯„ä¼°æ¡†æ¶ç¤ºä¾‹</span>
<span class="k">class</span> <span class="nc">ModelBasedEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">judge_model</span><span class="o">=</span><span class="s2">&quot;gpt-4-vision&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">judge</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">judge_model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">model_answer</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        è¯·è¯„ä¼°æ¨¡å‹å›ç­”çš„è´¨é‡ï¼ˆ1-5åˆ†ï¼‰ï¼š</span>

<span class="s2">        è¯„ä¼°ç»´åº¦ï¼š</span>

<span class="s2">        1. äº‹å®å‡†ç¡®æ€§ï¼šå›ç­”æ˜¯å¦ä¸å›¾åƒå†…å®¹ä¸€è‡´</span>
<span class="s2">        2. å®Œæ•´æ€§ï¼šæ˜¯å¦å……åˆ†å›ç­”äº†é—®é¢˜</span>
<span class="s2">        3. ç›¸å…³æ€§ï¼šå›ç­”æ˜¯å¦åˆ‡é¢˜</span>
<span class="s2">        4. æ¸…æ™°åº¦ï¼šè¡¨è¾¾æ˜¯å¦æ¸…æ¥šæ˜“æ‡‚</span>

<span class="s2">        å›¾åƒï¼š[å›¾åƒ]</span>
<span class="s2">        é—®é¢˜ï¼š</span><span class="si">{</span><span class="n">question</span><span class="si">}</span>
<span class="s2">        æ¨¡å‹å›ç­”ï¼š</span><span class="si">{</span><span class="n">model_answer</span><span class="si">}</span>
<span class="s2">        </span><span class="si">{</span><span class="s2">&quot;å‚è€ƒç­”æ¡ˆï¼š&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="si">}</span>

<span class="s2">        è¯·ç»™å‡ºï¼š</span>

<span class="s2">        - æ€»åˆ†ï¼ˆ1-5ï¼‰</span>
<span class="s2">        - å„ç»´åº¦å¾—åˆ†</span>
<span class="s2">        - è¯„ä»·ç†ç”±</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">judge</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</code></pre></div>

<p><strong>ä¼˜åŠ¿ä¸æŒ‘æˆ˜ï¼š</strong></p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ›´æ¥è¿‘äººç±»åˆ¤æ–­</li>
<li>å¯è§£é‡Šæ€§å¼º</li>
<li>çµæ´»é€‚åº”ä¸åŒä»»åŠ¡</li>
</ul>
<p>æŒ‘æˆ˜ï¼š</p>
<ul>
<li>è¯„ä¼°æˆæœ¬é«˜</li>
<li>å¯èƒ½å­˜åœ¨åè§</li>
<li>ä¸€è‡´æ€§é—®é¢˜</li>
</ul>
<h3 id="723">7.2.3 ä»»åŠ¡ç‰¹å®šæŒ‡æ ‡è®¾è®¡</h3>
<p>é’ˆå¯¹ä¸åŒä»»åŠ¡è®¾è®¡ä¸“é—¨çš„è¯„ä¼°æŒ‡æ ‡ï¼š</p>
<ol>
<li><strong>å¹»è§‰æ£€æµ‹æŒ‡æ ‡</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1"># CHAIR (Caption Hallucination Assessment with Image Relevance)</span>
<span class="k">def</span> <span class="nf">calculate_chair</span><span class="p">(</span><span class="n">generated_caption</span><span class="p">,</span> <span class="n">image_objects</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    è®¡ç®—æè¿°ä¸­çš„å¹»è§‰ç‡</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mentioned_objects</span> <span class="o">=</span> <span class="n">extract_objects</span><span class="p">(</span><span class="n">generated_caption</span><span class="p">)</span>

    <span class="c1"># å¥å­çº§å¹»è§‰ç‡</span>
    <span class="n">hallucinated_sentences</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_sentences</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">generated_caption</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">generated_caption</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="n">sentence_objects</span> <span class="o">=</span> <span class="n">extract_objects</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">image_objects</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">sentence_objects</span><span class="p">):</span>
            <span class="n">hallucinated_sentences</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">chairs</span> <span class="o">=</span> <span class="n">hallucinated_sentences</span> <span class="o">/</span> <span class="n">total_sentences</span>

    <span class="c1"># ç‰©ä½“çº§å¹»è§‰ç‡</span>
    <span class="n">hallucinated_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">mentioned_objects</span> 
                               <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">image_objects</span><span class="p">])</span>
    <span class="n">chairi</span> <span class="o">=</span> <span class="n">hallucinated_objects</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">mentioned_objects</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;CHAIRs&#39;</span><span class="p">:</span> <span class="n">chairs</span><span class="p">,</span> <span class="s1">&#39;CHAIRi&#39;</span><span class="p">:</span> <span class="n">chairi</span><span class="p">}</span>
</code></pre></div>

<ol start="2">
<li><strong>ç©ºé—´ç†è§£æŒ‡æ ‡</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate_spatial_understanding</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    è¯„ä¼°æ¨¡å‹çš„ç©ºé—´å…³ç³»ç†è§£èƒ½åŠ›</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spatial_relations</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;å·¦&#39;</span><span class="p">,</span> <span class="s1">&#39;å³&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸Š&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸‹&#39;</span><span class="p">,</span> <span class="s1">&#39;å‰&#39;</span><span class="p">,</span> <span class="s1">&#39;å&#39;</span><span class="p">,</span> <span class="s1">&#39;å†…&#39;</span><span class="p">,</span> <span class="s1">&#39;å¤–&#39;</span><span class="p">]</span>

    <span class="n">correct_relations</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_relations</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">spatial_relations</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">ground_truth</span><span class="p">:</span>
            <span class="n">total_relations</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">check_spatial_relation</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">,</span> <span class="n">relation</span><span class="p">):</span>
                <span class="n">correct_relations</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">correct_relations</span> <span class="o">/</span> <span class="n">total_relations</span> <span class="k">if</span> <span class="n">total_relations</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</code></pre></div>

<ol start="3">
<li><strong>æŒ‡ä»¤éµå¾ªåº¦æŒ‡æ ‡</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">instruction_following_score</span><span class="p">(</span><span class="n">instruction</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    è¯„ä¼°æ¨¡å‹å¯¹æŒ‡ä»¤çš„éµå¾ªç¨‹åº¦</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">requirements</span> <span class="o">=</span> <span class="n">parse_requirements</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span>

    <span class="n">scores</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;format_compliance&#39;</span><span class="p">:</span> <span class="n">check_format</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">requirements</span><span class="o">.</span><span class="n">format</span><span class="p">),</span>
        <span class="s1">&#39;length_compliance&#39;</span><span class="p">:</span> <span class="n">check_length</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">requirements</span><span class="o">.</span><span class="n">length</span><span class="p">),</span>
        <span class="s1">&#39;content_coverage&#39;</span><span class="p">:</span> <span class="n">check_content</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">requirements</span><span class="o">.</span><span class="n">topics</span><span class="p">),</span>
        <span class="s1">&#39;constraint_satisfaction&#39;</span><span class="p">:</span> <span class="n">check_constraints</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">requirements</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</code></pre></div>

<h3 id="724">7.2.4 å¤šç»´åº¦è¯„ä¼°æ¡†æ¶</h3>
<p>æ„å»ºç»¼åˆè¯„ä¼°ä½“ç³»ï¼Œä»å¤šä¸ªè§’åº¦å…¨é¢è¯„ä¼°æ¨¡å‹ï¼š</p>
<div class="codehilite"><pre><span></span><code>è¯„ä¼°ç»´åº¦ä½“ç³»ï¼š
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  VLM è¯„ä¼°   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚åŸºç¡€èƒ½åŠ› â”‚      â”‚ é«˜çº§èƒ½åŠ›  â”‚     â”‚ å®‰å…¨å¯¹é½  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚

   - ç‰©ä½“è¯†åˆ«         - æ¨ç†èƒ½åŠ›         - æœ‰å®³å†…å®¹è¿‡æ»¤
   - å±æ€§ç†è§£         - åˆ›é€ æ€§           - åè§æ£€æµ‹
   - å…³ç³»ç†è§£         - çŸ¥è¯†è¿ç”¨         - éšç§ä¿æŠ¤
   - è®¡æ•°èƒ½åŠ›         - å¤šè½®å¯¹è¯         - äº‹å®æ€§
</code></pre></div>

<h2 id="73">7.3 äººå·¥è¯„ä¼°çš„ç»„ç»‡ä¸åˆ†æ</h2>
<h3 id="731">7.3.1 è¯„ä¼°ä»»åŠ¡è®¾è®¡åŸåˆ™</h3>
<p>è®¾è®¡é«˜è´¨é‡çš„äººå·¥è¯„ä¼°ä»»åŠ¡éœ€è¦éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p>
<ol>
<li><strong>æ˜ç¡®æ€§åŸåˆ™</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>âŒ æ¨¡ç³ŠæŒ‡ä»¤ï¼š
&quot;è¯„ä¼°è¿™ä¸ªå›ç­”çš„è´¨é‡&quot;

âœ… æ˜ç¡®æŒ‡ä»¤ï¼š
&quot;æ ¹æ®ä»¥ä¸‹æ ‡å‡†è¯„ä¼°å›ç­”è´¨é‡ï¼š

1. äº‹å®å‡†ç¡®æ€§ï¼ˆ0-2åˆ†ï¼‰ï¼šæè¿°æ˜¯å¦ä¸å›¾åƒå†…å®¹ä¸€è‡´
2. å®Œæ•´æ€§ï¼ˆ0-2åˆ†ï¼‰ï¼šæ˜¯å¦åŒ…å«æ‰€æœ‰é‡è¦ä¿¡æ¯
3. æµç•…æ€§ï¼ˆ0-1åˆ†ï¼‰ï¼šè¯­è¨€æ˜¯å¦é€šé¡ºè‡ªç„¶&quot;
</code></pre></div>

<ol start="2">
<li><strong>å¯æµ‹é‡æ€§åŸåˆ™</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1"># è®¾è®¡å¯é‡åŒ–çš„è¯„ä¼°æ ‡å‡†</span>
<span class="n">evaluation_rubric</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;äº‹å®å‡†ç¡®æ€§&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;åŒ…å«æ˜æ˜¾é”™è¯¯ä¿¡æ¯&quot;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;åŸºæœ¬æ­£ç¡®ä½†æœ‰å°é”™è¯¯&quot;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;å®Œå…¨å‡†ç¡®&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;ç›¸å…³æ€§&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;ç­”éæ‰€é—®&quot;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;éƒ¨åˆ†ç›¸å…³&quot;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;é«˜åº¦ç›¸å…³&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ol start="3">
<li><strong>ä»£è¡¨æ€§åŸåˆ™</strong></li>
</ol>
<p>æ ·æœ¬é€‰æ‹©åº”è¦†ç›–ï¼š</p>
<ul>
<li>ä¸åŒéš¾åº¦çº§åˆ«</li>
<li>å„ç§å›¾åƒç±»å‹ï¼ˆè‡ªç„¶åœºæ™¯ã€å›¾è¡¨ã€æ–‡æ¡£ç­‰ï¼‰</li>
<li>å¤šæ ·åŒ–çš„é—®é¢˜ç±»å‹</li>
<li>è¾¹ç•Œæ¡ˆä¾‹å’Œå›°éš¾æ ·æœ¬</li>
</ul>
<h3 id="732">7.3.2 æ ‡æ³¨æŒ‡å—åˆ¶å®š</h3>
<p>å®Œå–„çš„æ ‡æ³¨æŒ‡å—æ˜¯ä¿è¯è¯„ä¼°è´¨é‡çš„å…³é”®ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="gh"># VLM è¾“å‡ºè¯„ä¼°æ ‡æ³¨æŒ‡å—</span>

<span class="gu">## 1. è¯„ä¼°ç»´åº¦å®šä¹‰</span>

<span class="gu">### 1.1 äº‹å®å‡†ç¡®æ€§ï¼ˆFactual Accuracyï¼‰</span>
<span class="gs">**å®šä¹‰**</span>ï¼šæ¨¡å‹è¾“å‡ºä¸å›¾åƒå†…å®¹çš„ä¸€è‡´ç¨‹åº¦

<span class="gs">**è¯„åˆ†æ ‡å‡†**</span>ï¼š

<span class="k">-</span><span class="w"> </span><span class="gs">**ä¼˜ç§€(3åˆ†)**</span>ï¼šæ‰€æœ‰æè¿°å®Œå…¨å‡†ç¡®ï¼Œæ— ä»»ä½•äº‹å®é”™è¯¯
<span class="k">-</span><span class="w"> </span><span class="gs">**è‰¯å¥½(2åˆ†)**</span>ï¼šä¸»è¦ä¿¡æ¯æ­£ç¡®ï¼Œå­˜åœ¨minorç»†èŠ‚é”™è¯¯
<span class="k">-</span><span class="w"> </span><span class="gs">**ä¸€èˆ¬(1åˆ†)**</span>ï¼šéƒ¨åˆ†ä¿¡æ¯æ­£ç¡®ï¼Œä½†æœ‰æ˜æ˜¾é”™è¯¯
<span class="k">-</span><span class="w"> </span><span class="gs">**å·®(0åˆ†)**</span>ï¼šå­˜åœ¨ä¸¥é‡äº‹å®é”™è¯¯æˆ–å¹»è§‰

<span class="gs">**ç¤ºä¾‹**</span>ï¼š
å›¾åƒï¼š[ä¸€åªæ©™è‰²çš„çŒ«ååœ¨è“è‰²æ²™å‘ä¸Š]

<span class="k">-</span><span class="w"> </span>ä¼˜ç§€ï¼š&quot;ä¸€åªæ©™è‰²çš„çŒ«åœ¨è“è‰²æ²™å‘ä¸Š&quot;
<span class="k">-</span><span class="w"> </span>è‰¯å¥½ï¼š&quot;ä¸€åªçŒ«åœ¨æ²™å‘ä¸Š&quot;ï¼ˆç¼ºå°‘é¢œè‰²ä¿¡æ¯ï¼‰
<span class="k">-</span><span class="w"> </span>ä¸€èˆ¬ï¼š&quot;ä¸€åªç‹—åœ¨æ²™å‘ä¸Š&quot;ï¼ˆç‰©ä½“è¯†åˆ«é”™è¯¯ï¼‰
<span class="k">-</span><span class="w"> </span>å·®ï¼š&quot;å¤šåªçŒ«åœ¨åœ°æ¿ä¸Š&quot;ï¼ˆå®Œå…¨é”™è¯¯ï¼‰

<span class="gu">### 1.2 å®Œæ•´æ€§ï¼ˆCompletenessï¼‰</span>
[è¯¦ç»†å®šä¹‰å’Œç¤ºä¾‹...]

<span class="gu">## 2. æ ‡æ³¨æµç¨‹</span>

<span class="k">1.</span> <span class="gs">**åˆæ­¥æµè§ˆ**</span>ï¼šå¿«é€ŸæŸ¥çœ‹å›¾åƒï¼Œç†è§£åœºæ™¯
<span class="k">2.</span> <span class="gs">**ä»”ç»†å¯¹æ¯”**</span>ï¼šé€å¥å¯¹æ¯”æ¨¡å‹è¾“å‡ºä¸å›¾åƒ
<span class="k">3.</span> <span class="gs">**è¯„åˆ†è®°å½•**</span>ï¼šæŒ‰ç»´åº¦ç»™åˆ†å¹¶è®°å½•ç†ç”±
<span class="k">4.</span> <span class="gs">**ä¸€è‡´æ€§æ£€æŸ¥**</span>ï¼šç¡®ä¿è¯„åˆ†æ ‡å‡†ä¸€è‡´

<span class="gu">## 3. å¸¸è§é—®é¢˜å¤„ç†</span>

Q: å¦‚æœæ¨¡å‹ä½¿ç”¨åŒä¹‰è¯æ€ä¹ˆåŠï¼Ÿ
A: åŒä¹‰è¯ä¸æ‰£åˆ†ï¼ˆå¦‚&quot;æ±½è½¦&quot;vs&quot;è½¿è½¦&quot;ï¼‰

Q: å¦‚ä½•å¤„ç†ä¸»è§‚æè¿°ï¼Ÿ
A: åªè¦åˆç†å³å¯ï¼ˆå¦‚&quot;ç¾ä¸½çš„&quot;é£æ™¯ï¼‰
</code></pre></div>

<h3 id="733">7.3.3 ä¸€è‡´æ€§æ£€éªŒ</h3>
<p>ç¡®ä¿å¤šä¸ªæ ‡æ³¨è€…ä¹‹é—´çš„ä¸€è‡´æ€§ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># è®¡ç®—æ ‡æ³¨è€…é—´ä¸€è‡´æ€§</span>
<span class="k">def</span> <span class="nf">calculate_inter_rater_agreement</span><span class="p">(</span><span class="n">annotations</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    è®¡ç®— Fleiss&#39; Kappa ç³»æ•°</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">annotations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># è¯„ä¼°é¡¹ç›®æ•°</span>
    <span class="n">n_raters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span>      <span class="c1"># æ ‡æ³¨è€…æ•°é‡</span>
    <span class="n">n_categories</span> <span class="o">=</span> <span class="mi">5</span>                 <span class="c1"># è¯„åˆ†ç­‰çº§æ•°ï¼ˆå¦‚1-5åˆ†ï¼‰</span>

    <span class="c1"># æ„å»ºè¯„åˆ†çŸ©é˜µ</span>
    <span class="n">rating_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_items</span><span class="p">,</span> <span class="n">n_categories</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">item_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_items</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rater_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_raters</span><span class="p">):</span>
            <span class="n">rating</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[</span><span class="n">rater_idx</span><span class="p">][</span><span class="n">item_idx</span><span class="p">]</span>
            <span class="n">rating_matrix</span><span class="p">[</span><span class="n">item_idx</span><span class="p">,</span> <span class="n">rating</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># è®¡ç®— Kappa</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="n">fleiss_kappa</span><span class="p">(</span><span class="n">rating_matrix</span><span class="p">)</span>

    <span class="c1"># è§£é‡Š Kappa å€¼</span>
    <span class="k">if</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
        <span class="n">agreement</span> <span class="o">=</span> <span class="s2">&quot;å¾®å¼±&quot;</span>
    <span class="k">elif</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">:</span>
        <span class="n">agreement</span> <span class="o">=</span> <span class="s2">&quot;ä¸€èˆ¬&quot;</span>
    <span class="k">elif</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">:</span>
        <span class="n">agreement</span> <span class="o">=</span> <span class="s2">&quot;ä¸­ç­‰&quot;</span>
    <span class="k">elif</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
        <span class="n">agreement</span> <span class="o">=</span> <span class="s2">&quot;è¾ƒå¼º&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">agreement</span> <span class="o">=</span> <span class="s2">&quot;æå¼º&quot;</span>

    <span class="k">return</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">agreement</span>
</code></pre></div>

<p><strong>æé«˜ä¸€è‡´æ€§çš„æ–¹æ³•ï¼š</strong></p>
<ol>
<li><strong>åŸ¹è®­é˜¶æ®µ</strong>ï¼šæ‰€æœ‰æ ‡æ³¨è€…æ ‡æ³¨ç›¸åŒæ ·æœ¬ï¼Œè®¨è®ºåˆ†æ­§</li>
<li><strong>é»„é‡‘æ ‡å‡†</strong>ï¼šå®šæœŸæ’å…¥å·²çŸ¥ç­”æ¡ˆçš„æ ·æœ¬æ£€éªŒ</li>
<li><strong>è¿­ä»£ä¼˜åŒ–</strong>ï¼šæ ¹æ®åˆ†æ­§æ¡ˆä¾‹æ›´æ–°æ ‡æ³¨æŒ‡å—</li>
<li><strong>åŒé‡æ ‡æ³¨</strong>ï¼šå…³é”®æ ·æœ¬ç”±å¤šäººç‹¬ç«‹æ ‡æ³¨</li>
</ol>
<h3 id="734">7.3.4 è¯„ä¼°ç»“æœçš„ç»Ÿè®¡åˆ†æ</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ç»¼åˆåˆ†ææ¡†æ¶</span>
<span class="k">class</span> <span class="nc">EvaluationAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotations</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotations</span> <span class="o">=</span> <span class="n">annotations</span>

    <span class="k">def</span> <span class="nf">basic_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åŸºç¡€ç»Ÿè®¡é‡&quot;&quot;&quot;</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotations</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;quantiles&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">dimension_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç»´åº¦é—´ç›¸å…³æ€§åˆ†æ&quot;&quot;&quot;</span>
        <span class="c1"># åˆ†æä¸åŒè¯„ä¼°ç»´åº¦ä¹‹é—´çš„ç›¸å…³æ€§</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;completeness&#39;</span><span class="p">,</span> <span class="s1">&#39;fluency&#39;</span><span class="p">]</span>
        <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">annotations</span><span class="p">[</span><span class="n">dimensions</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">corr_matrix</span>

    <span class="k">def</span> <span class="nf">error_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é”™è¯¯æ¨¡å¼åˆ†æ&quot;&quot;&quot;</span>
        <span class="n">error_patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;hallucination&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;missing_info&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;wrong_attribute&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;spatial_error&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        <span class="c1"># åˆ†æå¸¸è§é”™è¯¯ç±»å‹</span>
        <span class="k">return</span> <span class="n">error_patterns</span>

    <span class="k">def</span> <span class="nf">significance_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_a_scores</span><span class="p">,</span> <span class="n">model_b_scores</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ˜¾è‘—æ€§æ£€éªŒ&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

        <span class="c1"># é…å¯¹tæ£€éªŒ</span>
        <span class="n">t_stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_rel</span><span class="p">(</span><span class="n">model_a_scores</span><span class="p">,</span> <span class="n">model_b_scores</span><span class="p">)</span>

        <span class="c1"># Bootstrap ç½®ä¿¡åŒºé—´</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">model_a_scores</span> <span class="o">-</span> <span class="n">model_b_scores</span>
        <span class="n">bootstrap_means</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">bootstrap_means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>

        <span class="n">ci_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bootstrap_means</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
        <span class="n">ci_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bootstrap_means</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;t_statistic&#39;</span><span class="p">:</span> <span class="n">t_stat</span><span class="p">,</span>
            <span class="s1">&#39;p_value&#39;</span><span class="p">:</span> <span class="n">p_value</span><span class="p">,</span>
            <span class="s1">&#39;confidence_interval&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">ci_lower</span><span class="p">,</span> <span class="n">ci_upper</span><span class="p">),</span>
            <span class="s1">&#39;significant&#39;</span><span class="p">:</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span>
        <span class="p">}</span>
</code></pre></div>

<h2 id="74-ab">7.4 A/B æµ‹è¯•ä¸åœ¨çº¿è¯„ä¼°</h2>
<h3 id="741-ab">7.4.1 A/B æµ‹è¯•æ¡†æ¶æ­å»º</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># VLM A/B æµ‹è¯•æ¡†æ¶</span>
<span class="k">class</span> <span class="nc">VLMABTestFramework</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_a</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">model_a_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_b</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">model_b_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics_collector</span> <span class="o">=</span> <span class="n">MetricsCollector</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">assign_user_to_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”¨æˆ·åˆ†ç»„ç­–ç•¥&quot;&quot;&quot;</span>
        <span class="c1"># ä½¿ç”¨å“ˆå¸Œç¡®ä¿åŒä¸€ç”¨æˆ·å§‹ç»ˆåˆ†åˆ°åŒä¸€ç»„</span>
        <span class="n">hash_value</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">user_id</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">hash_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hash_value</span><span class="p">[:</span><span class="mi">8</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hash_int</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">traffic_split</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;model_b&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;model_a&#39;</span>

    <span class="k">def</span> <span class="nf">serve_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¤„ç†ç”¨æˆ·è¯·æ±‚&quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_user_to_group</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

        <span class="c1"># è®°å½•è¯·æ±‚ä¿¡æ¯</span>
        <span class="n">request_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_request</span><span class="p">(</span><span class="n">request_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>

        <span class="c1"># ç”Ÿæˆå“åº”</span>
        <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="s1">&#39;model_a&#39;</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_a</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_b</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>

        <span class="c1"># æ”¶é›†æŒ‡æ ‡</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_metrics</span><span class="p">(</span><span class="n">request_id</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">collect_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ”¶é›†è¯„ä¼°æŒ‡æ ‡&quot;&quot;&quot;</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;latency&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">latency</span><span class="p">,</span>
            <span class="s1">&#39;token_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">tokens</span><span class="p">),</span>
            <span class="s1">&#39;user_feedback&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># å¼‚æ­¥æ”¶é›†</span>
            <span class="s1">&#39;downstream_success&#39;</span><span class="p">:</span> <span class="kc">None</span>  <span class="c1"># è¿½è¸ªä¸‹æ¸¸ä»»åŠ¡æˆåŠŸç‡</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics_collector</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">request_id</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
</code></pre></div>

<h3 id="742">7.4.2 æµé‡åˆ†é…ç­–ç•¥</h3>
<div class="codehilite"><pre><span></span><code>æµé‡åˆ†é…æ–¹æ¡ˆï¼š

1. æ¸è¿›å¼å‘å¸ƒï¼ˆProgressive Rolloutï¼‰
   ç¬¬1å¤©ï¼š5% æµé‡
   ç¬¬3å¤©ï¼š10% æµé‡ï¼ˆå¦‚æœæŒ‡æ ‡æ­£å¸¸ï¼‰
   ç¬¬7å¤©ï¼š25% æµé‡
   ç¬¬14å¤©ï¼š50% æµé‡
   ç¬¬21å¤©ï¼š100% æµé‡ï¼ˆå…¨é‡å‘å¸ƒï¼‰

2. åˆ†å±‚å®éªŒï¼ˆStratified Testingï¼‰
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚    ç”¨æˆ·ç¾¤ä½“   â”‚  æµé‡å æ¯”  â”‚   ä¼˜å…ˆçº§    â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  å†…éƒ¨ç”¨æˆ·     â”‚    100%   â”‚     1      â”‚
   â”‚  Beta ç”¨æˆ·    â”‚     50%   â”‚     2      â”‚
   â”‚  VIP ç”¨æˆ·     â”‚     10%   â”‚     3      â”‚
   â”‚  æ™®é€šç”¨æˆ·     â”‚      5%   â”‚     4      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. åœ°åŸŸåˆ†é…ï¼ˆGeographic Splitï¼‰
   - å…ˆåœ¨å»¶è¿Ÿå®¹å¿åº¦é«˜çš„åœ°åŒºæµ‹è¯•
   - é€æ­¥æ‰©å±•åˆ°æ ¸å¿ƒåœ°åŒº
</code></pre></div>

<h3 id="743">7.4.3 æŒ‡æ ‡ç›‘æ§ä¸æ—©åœæœºåˆ¶</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ABTestMonitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_thresholds</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">alert_thresholds</span>

    <span class="k">def</span> <span class="nf">check_guardrail_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥æŠ¤æ æŒ‡æ ‡&quot;&quot;&quot;</span>
        <span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># 1. æ€§èƒ½æŠ¤æ </span>
        <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">p95_latency</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_thresholds</span><span class="o">.</span><span class="n">max_latency</span><span class="p">:</span>
            <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;P95å»¶è¿Ÿè¶…æ ‡: </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">p95_latency</span><span class="si">}</span><span class="s1">ms&#39;</span><span class="p">))</span>

        <span class="c1"># 2. è´¨é‡æŠ¤æ </span>
        <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">error_rate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_thresholds</span><span class="o">.</span><span class="n">max_error_rate</span><span class="p">:</span>
            <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;é”™è¯¯ç‡è¿‡é«˜: </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">error_rate</span><span class="si">:</span><span class="s1">.2%</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="c1"># 3. ç”¨æˆ·ä½“éªŒæŠ¤æ </span>
        <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">user_complaints</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_thresholds</span><span class="o">.</span><span class="n">max_complaints</span><span class="p">:</span>
            <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;WARNING&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ç”¨æˆ·æŠ•è¯‰å¢åŠ : </span><span class="si">{</span><span class="n">metrics</span><span class="o">.</span><span class="n">user_complaints</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">alerts</span>

    <span class="k">def</span> <span class="nf">statistical_significance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_metrics</span><span class="p">,</span> <span class="n">treatment_metrics</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ&quot;&quot;&quot;</span>
        <span class="c1"># è®¡ç®—æå‡å’Œç½®ä¿¡åŒºé—´</span>
        <span class="n">lift</span> <span class="o">=</span> <span class="p">(</span><span class="n">treatment_metrics</span><span class="o">.</span><span class="n">mean</span> <span class="o">-</span> <span class="n">control_metrics</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">control_metrics</span><span class="o">.</span><span class="n">mean</span>

        <span class="c1"># è®¡ç®—ç»Ÿè®¡åŠŸæ•ˆ</span>
        <span class="n">sample_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">treatment_metrics</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_statistical_power</span><span class="p">(</span>
            <span class="n">sample_size</span><span class="p">,</span> 
            <span class="n">lift</span><span class="p">,</span> 
            <span class="n">control_metrics</span><span class="o">.</span><span class="n">std</span>
        <span class="p">)</span>

        <span class="c1"># åˆ¤æ–­æ˜¯å¦è¾¾åˆ°æ˜¾è‘—æ€§</span>
        <span class="n">p_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_p_value</span><span class="p">(</span><span class="n">control_metrics</span><span class="p">,</span> <span class="n">treatment_metrics</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;lift&#39;</span><span class="p">:</span> <span class="n">lift</span><span class="p">,</span>
            <span class="s1">&#39;p_value&#39;</span><span class="p">:</span> <span class="n">p_value</span><span class="p">,</span>
            <span class="s1">&#39;power&#39;</span><span class="p">:</span> <span class="n">power</span><span class="p">,</span>
            <span class="s1">&#39;significant&#39;</span><span class="p">:</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="ow">and</span> <span class="n">power</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">,</span>
            <span class="s1">&#39;confidence_interval&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_ci</span><span class="p">(</span><span class="n">control_metrics</span><span class="p">,</span> <span class="n">treatment_metrics</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">early_stopping_decision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ—©åœå†³ç­–&quot;&quot;&quot;</span>
        <span class="c1"># 1. å¦‚æœä¸¥é‡è´Ÿå‘ï¼Œç«‹å³åœæ­¢</span>
        <span class="k">if</span> <span class="n">current_results</span><span class="o">.</span><span class="n">lift</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.1</span> <span class="ow">and</span> <span class="n">current_results</span><span class="o">.</span><span class="n">significant</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;STOP&#39;</span><span class="p">,</span> <span class="s1">&#39;æ˜¾è‘—è´Ÿå‘å½±å“&#39;</span>

        <span class="c1"># 2. å¦‚æœå·²ç»æ˜¾è‘—æ­£å‘ï¼Œå¯ä»¥æå‰ç»“æŸ</span>
        <span class="k">if</span> <span class="n">current_results</span><span class="o">.</span><span class="n">lift</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="ow">and</span> <span class="n">current_results</span><span class="o">.</span><span class="n">significant</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_results</span><span class="o">.</span><span class="n">sample_size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">min_sample_size</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;SUCCESS&#39;</span><span class="p">,</span> <span class="s1">&#39;æ˜¾è‘—æ­£å‘æå‡&#39;</span>

        <span class="c1"># 3. å¦‚æœæ ·æœ¬é‡è¶³å¤Ÿä½†æ— æ˜¾è‘—å·®å¼‚</span>
        <span class="k">if</span> <span class="n">current_results</span><span class="o">.</span><span class="n">sample_size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_sample_size</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;STOP&#39;</span><span class="p">,</span> <span class="s1">&#39;æ— æ˜¾è‘—å·®å¼‚&#39;</span>

        <span class="k">return</span> <span class="s1">&#39;CONTINUE&#39;</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>

<h3 id="744">7.4.4 é•¿æœŸæ•ˆæœè¿½è¸ª</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># é•¿æœŸæ•ˆæœè¿½è¸ªç³»ç»Ÿ</span>
<span class="k">class</span> <span class="nc">LongTermTracking</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">track_metric_degradation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">current_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿½è¸ªæŒ‡æ ‡é€€åŒ–&quot;&quot;&quot;</span>
        <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">current_value</span>
        <span class="p">})</span>

        <span class="c1"># æ£€æµ‹è¶‹åŠ¿</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>  <span class="c1"># è‡³å°‘ä¸€å‘¨æ•°æ®</span>
            <span class="n">recent</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:]]</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">14</span><span class="p">:</span><span class="o">-</span><span class="mi">7</span><span class="p">]]</span>

            <span class="c1"># Mann-Kendall è¶‹åŠ¿æ£€éªŒ</span>
            <span class="n">trend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mann_kendall_test</span><span class="p">(</span><span class="n">recent</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">trend</span> <span class="o">==</span> <span class="s1">&#39;decreasing&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alert</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s1"> å‡ºç°ä¸‹é™è¶‹åŠ¿&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">track_user_behavior_shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_queries</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¿½è¸ªç”¨æˆ·è¡Œä¸ºå˜åŒ–&quot;&quot;&quot;</span>
        <span class="c1"># åˆ†ææŸ¥è¯¢åˆ†å¸ƒå˜åŒ–</span>
        <span class="n">query_distribution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_query_distribution</span><span class="p">(</span><span class="n">user_queries</span><span class="p">)</span>

        <span class="c1"># æ£€æµ‹åˆ†å¸ƒæ¼‚ç§»</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_distribution_shift</span><span class="p">(</span><span class="n">query_distribution</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_retraining_alert</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">generate_weekly_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆå‘¨æŠ¥&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;performance_trends&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_performance_trends</span><span class="p">(),</span>
            <span class="s1">&#39;user_satisfaction&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_user_feedback</span><span class="p">(),</span>
            <span class="s1">&#39;error_patterns&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_error_patterns</span><span class="p">(),</span>
            <span class="s1">&#39;recommendations&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_recommendations</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">report</span>
</code></pre></div>

<h2 id="75-case-study-mmbench">7.5 Case Study: MMBench è¯„æµ‹ä½“ç³»æ·±åº¦è§£è¯»</h2>
<h3 id="751-circulareval">7.5.1 CircularEval ç­–ç•¥</h3>
<p>MMBench çš„å¾ªç¯è¯„ä¼°ç­–ç•¥è§£å†³äº†é€‰é¡¹é¡ºåºåè§é—®é¢˜ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># CircularEval å®ç°</span>
<span class="k">def</span> <span class="nf">circular_eval</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    é€šè¿‡æ‰“ä¹±é€‰é¡¹é¡ºåºå¤šæ¬¡è¯„ä¼°ï¼Œæ¶ˆé™¤ä½ç½®åè§</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_options</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">votes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># ç”Ÿæˆæ‰€æœ‰å¾ªç¯æ’åˆ—</span>
    <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_options</span><span class="p">):</span>
        <span class="c1"># å¾ªç¯ç§»åŠ¨é€‰é¡¹</span>
        <span class="n">shifted_options</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="n">shift</span><span class="p">:]</span> <span class="o">+</span> <span class="n">options</span><span class="p">[:</span><span class="n">shift</span><span class="p">]</span>
        <span class="n">option_map</span> <span class="o">=</span> <span class="p">{</span><span class="nb">chr</span><span class="p">(</span><span class="mi">65</span><span class="o">+</span><span class="n">i</span><span class="p">):</span> <span class="n">shifted_options</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_options</span><span class="p">)}</span>

        <span class="c1"># æ„é€ prompt</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">format_question</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">shifted_options</span><span class="p">)</span>

        <span class="c1"># è·å–æ¨¡å‹é¢„æµ‹</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>

        <span class="c1"># æ˜ å°„å›åŸå§‹é€‰é¡¹</span>
        <span class="k">if</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">option_map</span><span class="p">:</span>
            <span class="n">original_option</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">option_map</span><span class="p">[</span><span class="n">answer</span><span class="p">])</span>
            <span class="n">votes</span><span class="p">[</span><span class="n">original_option</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># æŠ•ç¥¨ç¡®å®šæœ€ç»ˆç­”æ¡ˆ</span>
    <span class="n">final_answer</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">votes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">votes</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
    <span class="n">confidence</span> <span class="o">=</span> <span class="n">votes</span><span class="p">[</span><span class="n">final_answer</span><span class="p">]</span> <span class="o">/</span> <span class="n">n_options</span>

    <span class="k">return</span> <span class="n">final_answer</span><span class="p">,</span> <span class="n">confidence</span>
</code></pre></div>

<h3 id="752">7.5.2 èƒ½åŠ›ç»´åº¦åˆ†è§£</h3>
<p>MMBench å°† VLM èƒ½åŠ›åˆ†è§£ä¸ºç»†ç²’åº¦ç»´åº¦ï¼š</p>
<div class="codehilite"><pre><span></span><code>èƒ½åŠ›åˆ†ç±»ä½“ç³»ï¼š
â”œâ”€â”€ æ„ŸçŸ¥èƒ½åŠ›ï¼ˆPerceptionï¼‰
â”‚   â”œâ”€â”€ ç‰©ä½“å®šä½ï¼ˆObject Localizationï¼‰
â”‚   â”œâ”€â”€ å±æ€§è¯†åˆ«ï¼ˆAttribute Recognitionï¼‰
â”‚   â”œâ”€â”€ åœºæ™¯ç†è§£ï¼ˆScene Understandingï¼‰
â”‚   â””â”€â”€ ç©ºé—´å…³ç³»ï¼ˆSpatial Relationshipï¼‰
â”‚
â”œâ”€â”€ æ¨ç†èƒ½åŠ›ï¼ˆReasoningï¼‰
â”‚   â”œâ”€â”€ é€»è¾‘æ¨ç†ï¼ˆLogical Reasoningï¼‰
â”‚   â”œâ”€â”€ æ•°å€¼è®¡ç®—ï¼ˆNumerical Calculationï¼‰
â”‚   â”œâ”€â”€ å¸¸è¯†æ¨ç†ï¼ˆCommonsense Reasoningï¼‰
â”‚   â””â”€â”€ å› æœæ¨æ–­ï¼ˆCausal Inferenceï¼‰
â”‚
â””â”€â”€ çŸ¥è¯†èƒ½åŠ›ï¼ˆKnowledgeï¼‰
    â”œâ”€â”€ å­¦ç§‘çŸ¥è¯†ï¼ˆSubject Knowledgeï¼‰
    â”œâ”€â”€ ç¤¾ä¼šå¸¸è¯†ï¼ˆSocial Conventionï¼‰
    â”œâ”€â”€ å†å²æ–‡åŒ–ï¼ˆHistorical Cultureï¼‰
    â””â”€â”€ åäººåœ°æ ‡ï¼ˆCelebrity &amp; Landmarkï¼‰
</code></pre></div>

<h3 id="753">7.5.3 è¯„æµ‹ç»“æœåˆ†æ</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># MMBench ç»“æœåˆ†æå·¥å…·</span>
<span class="k">class</span> <span class="nc">MMBenchAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">capability_radar_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆèƒ½åŠ›é›·è¾¾å›¾&quot;&quot;&quot;</span>
        <span class="n">capabilities</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Object Localization&#39;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>
            <span class="s1">&#39;Attribute Recognition&#39;</span><span class="p">:</span> <span class="mf">0.92</span><span class="p">,</span>
            <span class="s1">&#39;Spatial Relationship&#39;</span><span class="p">:</span> <span class="mf">0.76</span><span class="p">,</span>
            <span class="s1">&#39;Logical Reasoning&#39;</span><span class="p">:</span> <span class="mf">0.68</span><span class="p">,</span>
            <span class="s1">&#39;Commonsense&#39;</span><span class="p">:</span> <span class="mf">0.81</span><span class="p">,</span>
            <span class="s1">&#39;Subject Knowledge&#39;</span><span class="p">:</span> <span class="mf">0.73</span>
        <span class="p">}</span>

        <span class="c1"># ç”Ÿæˆé›·è¾¾å›¾æ•°æ®</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">capabilities</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">capabilities</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">angles</span><span class="p">,</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">error_case_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é”™è¯¯æ¡ˆä¾‹åˆ†æ&quot;&quot;&quot;</span>
        <span class="n">error_patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;position_bias&#39;</span><span class="p">:</span> <span class="p">[],</span>      <span class="c1"># ä½ç½®åå¥½é”™è¯¯</span>
            <span class="s1">&#39;language_bias&#39;</span><span class="p">:</span> <span class="p">[],</span>      <span class="c1"># è¯­è¨€åè§é”™è¯¯</span>
            <span class="s1">&#39;hallucination&#39;</span><span class="p">:</span> <span class="p">[],</span>      <span class="c1"># å¹»è§‰é”™è¯¯</span>
            <span class="s1">&#39;reasoning_fail&#39;</span><span class="p">:</span> <span class="p">[],</span>     <span class="c1"># æ¨ç†å¤±è´¥</span>
            <span class="s1">&#39;knowledge_gap&#39;</span><span class="p">:</span> <span class="p">[]</span>       <span class="c1"># çŸ¥è¯†ç¼ºå¤±</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;correct&#39;</span><span class="p">]:</span>
                <span class="n">error_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classify_error</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">error_patterns</span><span class="p">[</span><span class="n">error_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">error_patterns</span>

    <span class="k">def</span> <span class="nf">compare_with_baselines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä¸åŸºå‡†æ¨¡å‹å¯¹æ¯”&quot;&quot;&quot;</span>
        <span class="n">baselines</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;GPT-4V&#39;</span><span class="p">:</span> <span class="mf">0.776</span><span class="p">,</span>
            <span class="s1">&#39;Gemini-Pro&#39;</span><span class="p">:</span> <span class="mf">0.739</span><span class="p">,</span>
            <span class="s1">&#39;Claude-3&#39;</span><span class="p">:</span> <span class="mf">0.768</span><span class="p">,</span>
            <span class="s1">&#39;Qwen-VL-Plus&#39;</span><span class="p">:</span> <span class="mf">0.726</span>
        <span class="p">}</span>

        <span class="n">our_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">])</span>

        <span class="n">comparison</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span>
                <span class="s1">&#39;delta&#39;</span><span class="p">:</span> <span class="n">our_score</span> <span class="o">-</span> <span class="n">score</span><span class="p">,</span>
                <span class="s1">&#39;relative&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">our_score</span> <span class="o">-</span> <span class="n">score</span><span class="p">)</span> <span class="o">/</span> <span class="n">score</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">baselines</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">comparison</span>
</code></pre></div>

<h2 id="76">7.6 é«˜çº§è¯é¢˜</h2>
<h3 id="761">7.6.1 å¹»è§‰è¯„ä¼°æ–¹æ³•</h3>
<p><strong>POPE (Polling-based Object Probing Evaluation)</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">POPEEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_detector</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">object_detector</span>

    <span class="k">def</span> <span class="nf">generate_pope_questions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆ POPE è¯„ä¼°é—®é¢˜&quot;&quot;&quot;</span>
        <span class="c1"># æ£€æµ‹å›¾åƒä¸­çš„çœŸå®ç‰©ä½“</span>
        <span class="n">real_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># æ„é€ ä¸‰ç§ç±»å‹çš„é—®é¢˜</span>
        <span class="n">questions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;random&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_sampling</span><span class="p">(</span><span class="n">real_objects</span><span class="p">),</span>
            <span class="s1">&#39;popular&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">popular_sampling</span><span class="p">(</span><span class="n">real_objects</span><span class="p">),</span>
            <span class="s1">&#39;adversarial&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">adversarial_sampling</span><span class="p">(</span><span class="n">real_objects</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">questions</span>

    <span class="k">def</span> <span class="nf">random_sampling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">real_objects</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;éšæœºé‡‡æ ·ç­–ç•¥&quot;&quot;&quot;</span>
        <span class="n">questions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># 50% çœŸå®ç‰©ä½“</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">real_objects</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_objects</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">questions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;Is there a </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> in the image?&quot;</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">))</span>

        <span class="c1"># 50% ä¸å­˜åœ¨çš„ç‰©ä½“</span>
        <span class="n">fake_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_random_objects</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">real_objects</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">fake_objects</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">real_objects</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">questions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;Is there a </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> in the image?&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">questions</span>

    <span class="k">def</span> <span class="nf">popular_sampling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">real_objects</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;é¢‘ç¹å…±ç°ç‰©ä½“é‡‡æ ·&quot;&quot;&quot;</span>
        <span class="c1"># é€‰æ‹©ç»å¸¸ä¸€èµ·å‡ºç°ä½†å®é™…ä¸åœ¨å›¾ä¸­çš„ç‰©ä½“</span>
        <span class="n">co_occurring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_co_occurring_objects</span><span class="p">(</span><span class="n">real_objects</span><span class="p">)</span>
        <span class="n">fake_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">co_occurring</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">real_objects</span><span class="p">]</span>

        <span class="n">questions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">real_objects</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">real_objects</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">questions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;Is there a </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> in the image?&quot;</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">fake_objects</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">real_objects</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">questions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;Is there a </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> in the image?&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">questions</span>

    <span class="k">def</span> <span class="nf">evaluate_hallucination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">questions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¯„ä¼°å¹»è§‰ç‡&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;yes_bias&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># å€¾å‘äºå›ç­”&quot;æ˜¯&quot;</span>
            <span class="s1">&#39;hallucination_rate&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">yes_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">false_positive</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">question</span><span class="p">,</span> <span class="n">ground_truth</span> <span class="ow">in</span> <span class="n">questions</span><span class="p">:</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">answer</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="n">ground_truth</span><span class="p">:</span>
                <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="s2">&quot;Yes&quot;</span><span class="p">:</span>
                <span class="n">yes_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">ground_truth</span> <span class="o">==</span> <span class="s2">&quot;No&quot;</span><span class="p">:</span>
                    <span class="n">false_positive</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">questions</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;yes_bias&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yes_count</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">questions</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;hallucination_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">false_positive</span> <span class="o">/</span> <span class="nb">len</span><span class="p">([</span><span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">questions</span> <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;No&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">results</span>
</code></pre></div>

<h3 id="762-chain-of-thought">7.6.2 Chain-of-Thought è¯„æµ‹è®¾è®¡</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CoTEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;visual_grounding&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;é¦–å…ˆ.*å›¾åƒ.*çœ‹åˆ°&#39;</span><span class="p">,</span>
            <span class="s1">&#39;step_by_step&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;ç¬¬[ä¸€äºŒä¸‰å››äº”]æ­¥&#39;</span><span class="p">,</span>
            <span class="s1">&#39;logical_connector&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;å› æ­¤|æ‰€ä»¥|ç”±äº|å› ä¸º&#39;</span><span class="p">,</span>
            <span class="s1">&#39;evidence_based&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;æ ¹æ®.*å¯ä»¥.*åˆ¤æ–­&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">evaluate_reasoning_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cot_response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¯„ä¼°æ¨ç†é“¾è´¨é‡&quot;&quot;&quot;</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># 1. æ¨ç†æ­¥éª¤å®Œæ•´æ€§</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_reasoning_steps</span><span class="p">(</span><span class="n">cot_response</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;completeness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># æœŸæœ›è‡³å°‘3æ­¥</span>

        <span class="c1"># 2. é€»è¾‘è¿è´¯æ€§</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;coherence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_logical_flow</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>

        <span class="c1"># 3. è§†è§‰grounding</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;grounding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_visual_grounding</span><span class="p">(</span><span class="n">cot_response</span><span class="p">)</span>

        <span class="c1"># 4. æœ€ç»ˆç­”æ¡ˆä¸€è‡´æ€§</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;consistency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_answer_consistency</span><span class="p">(</span><span class="n">cot_response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">scores</span>

    <span class="k">def</span> <span class="nf">check_visual_grounding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥æ¨ç†æ˜¯å¦åŸºäºè§†è§‰ä¿¡æ¯&quot;&quot;&quot;</span>
        <span class="n">visual_references</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;å›¾åƒ&#39;</span><span class="p">,</span> <span class="s1">&#39;å›¾ä¸­&#39;</span><span class="p">,</span> <span class="s1">&#39;çœ‹åˆ°&#39;</span><span class="p">,</span> <span class="s1">&#39;æ˜¾ç¤º&#39;</span><span class="p">,</span> <span class="s1">&#39;å‡ºç°&#39;</span><span class="p">,</span>
            <span class="s1">&#39;å·¦è¾¹&#39;</span><span class="p">,</span> <span class="s1">&#39;å³è¾¹&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸Šæ–¹&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸‹æ–¹&#39;</span><span class="p">,</span> <span class="s1">&#39;ä¸­é—´&#39;</span><span class="p">,</span>
            <span class="s1">&#39;é¢œè‰²&#39;</span><span class="p">,</span> <span class="s1">&#39;å½¢çŠ¶&#39;</span><span class="p">,</span> <span class="s1">&#39;å¤§å°&#39;</span>
        <span class="p">]</span>

        <span class="n">reference_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">visual_references</span> <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">reference_count</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># æœŸæœ›è‡³å°‘5æ¬¡è§†è§‰å¼•ç”¨</span>

    <span class="k">def</span> <span class="nf">compare_cot_vs_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">test_set</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å¯¹æ¯” CoT å’Œç›´æ¥å›ç­”çš„æ•ˆæœ&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;direct&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="p">[]},</span>
            <span class="s1">&#39;cot&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;reasoning_quality&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_set</span><span class="p">:</span>
            <span class="c1"># ç›´æ¥å›ç­”</span>
            <span class="n">direct_answer</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">answer_direct</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">question</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;direct&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">direct_answer</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">ground_truth</span><span class="p">)</span>

            <span class="c1"># CoT å›ç­”</span>
            <span class="n">cot_response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">answer_with_cot</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">question</span><span class="p">)</span>
            <span class="n">cot_answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_final_answer</span><span class="p">(</span><span class="n">cot_response</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;cot&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">cot_answer</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">ground_truth</span><span class="p">)</span>

            <span class="c1"># è¯„ä¼°æ¨ç†è´¨é‡</span>
            <span class="n">reasoning_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_reasoning_quality</span><span class="p">(</span><span class="n">cot_response</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;cot&#39;</span><span class="p">][</span><span class="s1">&#39;reasoning_quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reasoning_scores</span><span class="p">)</span>

        <span class="c1"># è®¡ç®—å¹³å‡å€¼</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;direct&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">n</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;cot&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">n</span>

        <span class="k">return</span> <span class="n">results</span>
</code></pre></div>

<h3 id="763">7.6.3 å¯¹æŠ—æ€§è¯„ä¼°</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AdversarialEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attack_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;typographic&#39;</span><span class="p">,</span>  <span class="c1"># æ–‡å­—ç±»æ”»å‡»</span>
            <span class="s1">&#39;compositional&#39;</span><span class="p">,</span> <span class="c1"># ç»„åˆæ€§æ”»å‡»  </span>
            <span class="s1">&#39;logical&#39;</span><span class="p">,</span>       <span class="c1"># é€»è¾‘é™·é˜±</span>
            <span class="s1">&#39;visual&#39;</span>         <span class="c1"># è§†è§‰å¯¹æŠ—</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">generate_adversarial_examples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_sample</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆå¯¹æŠ—æ ·æœ¬&quot;&quot;&quot;</span>
        <span class="n">adversarial_samples</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># 1. æ‰“å­—é”™è¯¯æ”»å‡»</span>
        <span class="n">typo_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_typos</span><span class="p">(</span><span class="n">original_sample</span><span class="p">)</span>
        <span class="n">adversarial_samples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;typographic&#39;</span><span class="p">,</span> <span class="n">typo_sample</span><span class="p">))</span>

        <span class="c1"># 2. å¦å®šè¯æ”»å‡»</span>
        <span class="n">negation_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_negation</span><span class="p">(</span><span class="n">original_sample</span><span class="p">)</span>
        <span class="n">adversarial_samples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;negation&#39;</span><span class="p">,</span> <span class="n">negation_sample</span><span class="p">))</span>

        <span class="c1"># 3. ç»„åˆå…³ç³»æ”»å‡»</span>
        <span class="n">comp_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_relationships</span><span class="p">(</span><span class="n">original_sample</span><span class="p">)</span>
        <span class="n">adversarial_samples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;compositional&#39;</span><span class="p">,</span> <span class="n">comp_sample</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">adversarial_samples</span>

    <span class="k">def</span> <span class="nf">evaluate_robustness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">test_set</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¯„ä¼°æ¨¡å‹é²æ£’æ€§&quot;&quot;&quot;</span>
        <span class="n">robustness_scores</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">original</span> <span class="ow">in</span> <span class="n">test_set</span><span class="p">:</span>
            <span class="c1"># åŸå§‹æ ·æœ¬å¾—åˆ†</span>
            <span class="n">original_score</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>

            <span class="c1"># ç”Ÿæˆå¯¹æŠ—æ ·æœ¬</span>
            <span class="n">adversarial_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_adversarial_examples</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">attack_type</span><span class="p">,</span> <span class="n">adv_sample</span> <span class="ow">in</span> <span class="n">adversarial_samples</span><span class="p">:</span>
                <span class="n">adv_score</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">adv_sample</span><span class="p">)</span>

                <span class="c1"># è®¡ç®—æ€§èƒ½ä¸‹é™</span>
                <span class="n">degradation</span> <span class="o">=</span> <span class="p">(</span><span class="n">original_score</span> <span class="o">-</span> <span class="n">adv_score</span><span class="p">)</span> <span class="o">/</span> <span class="n">original_score</span>
                <span class="n">robustness_scores</span><span class="p">[</span><span class="n">attack_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">degradation</span><span class="p">)</span>

        <span class="c1"># æ±‡æ€»ç»“æœ</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">attack</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mean_robustness&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
                <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">attack</span><span class="p">,</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">robustness_scores</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">summary</span>
</code></pre></div>

<h3 id="764">7.6.4 è·¨è¯­è¨€è¯„ä¼°æŒ‘æˆ˜</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CrossLingualEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">,</span> <span class="s1">&#39;ja&#39;</span><span class="p">,</span> <span class="s1">&#39;fr&#39;</span><span class="p">,</span> <span class="s1">&#39;es&#39;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">languages</span> <span class="o">=</span> <span class="n">languages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translators</span> <span class="o">=</span> <span class="p">{</span><span class="n">lang</span><span class="p">:</span> <span class="n">load_translator</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">languages</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">evaluate_language_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">question_en</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¯„ä¼°è·¨è¯­è¨€ä¸€è‡´æ€§&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># è‹±æ–‡åŸºå‡†ç­”æ¡ˆ</span>
        <span class="n">answer_en</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">question_en</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">languages</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># è·³è¿‡è‹±æ–‡</span>
            <span class="c1"># ç¿»è¯‘é—®é¢˜</span>
            <span class="n">question_translated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translators</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">question_en</span><span class="p">)</span>

            <span class="c1"># è·å–ç›®æ ‡è¯­è¨€ç­”æ¡ˆ</span>
            <span class="n">answer_lang</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">question_translated</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>

            <span class="c1"># ç¿»è¯‘å›è‹±æ–‡è¿›è¡Œæ¯”è¾ƒ</span>
            <span class="n">answer_back</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translators</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span><span class="o">.</span><span class="n">translate_back</span><span class="p">(</span><span class="n">answer_lang</span><span class="p">)</span>

            <span class="c1"># è®¡ç®—è¯­ä¹‰ç›¸ä¼¼åº¦</span>
            <span class="n">similarity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_similarity</span><span class="p">(</span><span class="n">answer_en</span><span class="p">,</span> <span class="n">answer_back</span><span class="p">)</span>

            <span class="n">results</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;answer&#39;</span><span class="p">:</span> <span class="n">answer_lang</span><span class="p">,</span>
                <span class="s1">&#39;back_translation&#39;</span><span class="p">:</span> <span class="n">answer_back</span><span class="p">,</span>
                <span class="s1">&#39;similarity&#39;</span><span class="p">:</span> <span class="n">similarity</span><span class="p">,</span>
                <span class="s1">&#39;consistent&#39;</span><span class="p">:</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="mf">0.85</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">identify_language_specific_challenges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¯†åˆ«ç‰¹å®šè¯­è¨€çš„æŒ‘æˆ˜&quot;&quot;&quot;</span>
        <span class="n">challenges</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;zh&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;é‡è¯ä½¿ç”¨ï¼ˆä¸€ä¸ªã€ä¸€åªã€ä¸€æ¡ï¼‰&#39;</span><span class="p">,</span>
                <span class="s1">&#39;æ–¹ä½è¯å·®å¼‚ï¼ˆä¸Šä¸‹å·¦å³ vs ä¸œå—è¥¿åŒ—ï¼‰&#39;</span><span class="p">,</span>
                <span class="s1">&#39;é¢œè‰²æè¿°ï¼ˆæ·±æµ… vs dark/lightï¼‰&#39;</span>
            <span class="p">],</span>
            <span class="s1">&#39;ja&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;æ•¬è¯­çº§åˆ«&#39;</span><span class="p">,</span>
                <span class="s1">&#39;æ±‰å­—/å‡åé€‰æ‹©&#39;</span><span class="p">,</span>
                <span class="s1">&#39;è®¡æ•°è¯ç³»ç»Ÿ&#39;</span>
            <span class="p">],</span>
            <span class="s1">&#39;ar&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;ä»å³åˆ°å·¦çš„ç©ºé—´æè¿°&#39;</span><span class="p">,</span>
                <span class="s1">&#39;åŒæ•°å½¢å¼&#39;</span><span class="p">,</span>
                <span class="s1">&#39;æ€§åˆ«ä¸€è‡´æ€§&#39;</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">challenges</span>
</code></pre></div>

<h2 id="77">7.7 æœ¬ç« å°ç»“</h2>
<p>æœ¬ç« ç³»ç»Ÿä»‹ç»äº† VLM è¯„ä¼°ä½“ç³»çš„è®¾è®¡ä¸å®ç°ã€‚å…³é”®è¦ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>
<p><strong>åŸºå‡†æµ‹è¯•é€‰æ‹©</strong>ï¼šéœ€è¦å¹³è¡¡é€šç”¨èƒ½åŠ›å’Œé¢†åŸŸç‰¹å®šè¯„ä¼°ï¼Œæ³¨æ„æ•°æ®æ³„éœ²é—®é¢˜</p>
</li>
<li>
<p><strong>è‡ªåŠ¨è¯„ä¼°æŒ‡æ ‡</strong>ï¼š
   - ä¼ ç»Ÿ NLP æŒ‡æ ‡å­˜åœ¨å±€é™æ€§
   - åŸºäºæ¨¡å‹çš„è¯„ä¼°æ›´æ¥è¿‘äººç±»åˆ¤æ–­
   - ä»»åŠ¡ç‰¹å®šæŒ‡æ ‡ï¼ˆå¹»è§‰æ£€æµ‹ã€ç©ºé—´ç†è§£ç­‰ï¼‰è‡³å…³é‡è¦</p>
</li>
<li>
<p><strong>äººå·¥è¯„ä¼°</strong>ï¼š
   - æ¸…æ™°çš„æ ‡æ³¨æŒ‡å—æ˜¯ä¿è¯è´¨é‡çš„å…³é”®
   - éœ€è¦è¿›è¡Œä¸€è‡´æ€§æ£€éªŒå’Œç»Ÿè®¡åˆ†æ
   - æˆæœ¬é«˜ä½†ä¸å¯æˆ–ç¼º</p>
</li>
<li>
<p><strong>åœ¨çº¿è¯„ä¼°</strong>ï¼š
   - A/B æµ‹è¯•éœ€è¦å®Œå–„çš„æ¡†æ¶å’Œç›‘æ§
   - æ³¨æ„æŠ¤æ æŒ‡æ ‡å’Œæ—©åœæœºåˆ¶
   - é•¿æœŸæ•ˆæœè¿½è¸ªåŒæ ·é‡è¦</p>
</li>
<li>
<p><strong>é«˜çº§æŠ€æœ¯</strong>ï¼š
   - å¹»è§‰è¯„ä¼°ï¼ˆPOPEã€CHAIRï¼‰
   - Chain-of-Thought è´¨é‡è¯„ä¼°
   - å¯¹æŠ—æ€§æµ‹è¯•å’Œè·¨è¯­è¨€ä¸€è‡´æ€§</p>
</li>
</ol>
<p><strong>æ ¸å¿ƒå…¬å¼å›é¡¾ï¼š</strong></p>
<ol>
<li>
<p>Fleiss' Kappaï¼ˆä¸€è‡´æ€§ï¼‰ï¼š$\kappa = \frac{P_o - P_e}{1 - P_e}$</p>
</li>
<li>
<p>ç»Ÿè®¡æ˜¾è‘—æ€§ï¼š$t = \frac{\bar{X}_1 - \bar{X}_2}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}}$</p>
</li>
<li>
<p>å¹»è§‰ç‡ï¼š$\text{CHAIR}_i = \frac{|\text{hallucinated objects}|}{|\text{mentioned objects}|}$</p>
</li>
</ol>
<h2 id="78">7.8 ç»ƒä¹ é¢˜</h2>
<h3 id="_1">åŸºç¡€é¢˜</h3>
<p><strong>ç»ƒä¹  7.1ï¼šåŸºå‡†æµ‹è¯•é€‰æ‹©</strong></p>
<p>ä½ æ­£åœ¨ä¸ºä¸€ä¸ªé¢å‘æ•™è‚²é¢†åŸŸçš„ VLM æ¨¡å‹è®¾è®¡è¯„ä¼°æ–¹æ¡ˆã€‚è¯¥æ¨¡å‹ä¸»è¦ç”¨äºï¼š</p>
<ol>
<li>è§£ç­”æ•°å­¦å‡ ä½•é¢˜ï¼ˆéœ€è¦ç†è§£å›¾å½¢ï¼‰</li>
<li>æ‰¹æ”¹å­¦ç”Ÿä½œä¸šï¼ˆè¯†åˆ«æ‰‹å†™æ–‡å­—ï¼‰</li>
<li>ç”Ÿæˆæ•™å­¦ææ–™è¯´æ˜</li>
</ol>
<p>è¯·é€‰æ‹©åˆé€‚çš„è¯„ä¼°åŸºå‡†å¹¶è¯´æ˜ç†ç”±ã€‚</p>
<p>ğŸ’¡ <strong>æç¤º</strong>ï¼šè€ƒè™‘é€šç”¨åŸºå‡†å’Œé¢†åŸŸç‰¹å®šåŸºå‡†çš„ç»„åˆã€‚</p>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>å»ºè®®é€‰æ‹©ä»¥ä¸‹åŸºå‡†æµ‹è¯•ç»„åˆï¼š</p>
<p><strong>é€šç”¨åŸºå‡†ï¼š</strong></p>
<ul>
<li>MathVistaï¼šä¸“é—¨è¯„ä¼°æ•°å­¦å›¾è¡¨ç†è§£èƒ½åŠ›</li>
<li>MMMUï¼šåŒ…å«å­¦ç§‘çŸ¥è¯†ï¼Œé€‚åˆæ•™è‚²åœºæ™¯</li>
</ul>
<p><strong>é¢†åŸŸç‰¹å®šåŸºå‡†ï¼š</strong></p>
<ul>
<li>OCRBenchï¼šè¯„ä¼°æ‰‹å†™æ–‡å­—è¯†åˆ«èƒ½åŠ›</li>
<li>ChartQAï¼šè¯„ä¼°å›¾è¡¨ç†è§£èƒ½åŠ›</li>
<li>è‡ªå»ºæ•™è‚²åœºæ™¯æµ‹è¯•é›†ï¼šåŒ…å«çœŸå®çš„ä½œä¸šæ‰¹æ”¹æ¡ˆä¾‹</li>
</ul>
<p><strong>ç†ç”±ï¼š</strong></p>
<ol>
<li>MathVista ç›´æ¥å¯¹åº”å‡ ä½•é¢˜è§£ç­”éœ€æ±‚</li>
<li>OCRBench è¦†ç›–æ‰‹å†™è¯†åˆ«åœºæ™¯</li>
<li>éœ€è¦è‡ªå»ºæµ‹è¯•é›†å› ä¸ºç°æœ‰åŸºå‡†å¯èƒ½ä¸å®Œå…¨è¦†ç›–æ•™è‚²ç‰¹å®šåœºæ™¯</li>
<li>é€šç”¨åŸºå‡†ç¡®ä¿æ¨¡å‹åŸºç¡€èƒ½åŠ›ï¼Œé¢†åŸŸåŸºå‡†éªŒè¯å®é™…åº”ç”¨æ•ˆæœ</li>
</ol>
</details>
<p><strong>ç»ƒä¹  7.2ï¼šæŒ‡æ ‡è®¾è®¡</strong></p>
<p>è®¾è®¡ä¸€ä¸ªè¯„ä¼° VLM æ¨¡å‹"æŒ‡ä»¤éµå¾ªèƒ½åŠ›"çš„æŒ‡æ ‡ã€‚æ¨¡å‹éœ€è¦æ ¹æ®ç”¨æˆ·æŒ‡ä»¤å¯¹å›¾åƒè¿›è¡Œç‰¹å®šæ ¼å¼çš„æè¿°ï¼ˆå¦‚"ç”¨ä¸‰å¥è¯æè¿°"ã€"åˆ—å‡º5ä¸ªå…³é”®å…ƒç´ "ç­‰ï¼‰ã€‚</p>
<p>ğŸ’¡ <strong>æç¤º</strong>ï¼šè€ƒè™‘æ ¼å¼éµå¾ªã€å†…å®¹å®Œæ•´æ€§ç­‰å¤šä¸ªç»´åº¦ã€‚</p>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>æŒ‡ä»¤éµå¾ªèƒ½åŠ›è¯„ä¼°æŒ‡æ ‡è®¾è®¡ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">instruction_following_score</span><span class="p">(</span><span class="n">instruction</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># 1. æ ¼å¼éµå¾ªåº¦ï¼ˆ40%æƒé‡ï¼‰</span>
    <span class="k">if</span> <span class="s2">&quot;ä¸‰å¥è¯&quot;</span> <span class="ow">in</span> <span class="n">instruction</span><span class="p">:</span>
        <span class="n">sentence_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;ã€‚&#39;</span><span class="p">))</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">sentence_count</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sentence_count</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;åˆ—å‡º&quot;</span> <span class="ow">in</span> <span class="n">instruction</span> <span class="ow">and</span> <span class="s2">&quot;ä¸ª&quot;</span> <span class="ow">in</span> <span class="n">instruction</span><span class="p">:</span>
        <span class="c1"># æå–æ•°é‡è¦æ±‚</span>
        <span class="n">required_items</span> <span class="o">=</span> <span class="n">extract_number</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span>
        <span class="n">actual_items</span> <span class="o">=</span> <span class="n">count_list_items</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">actual_items</span> <span class="o">==</span> <span class="n">required_items</span> <span class="k">else</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">actual_items</span> <span class="o">-</span> <span class="n">required_items</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>

    <span class="c1"># 2. å†…å®¹ç›¸å…³æ€§ï¼ˆ30%æƒé‡ï¼‰</span>
    <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;relevance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_relevance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>

    <span class="c1"># 3. æŒ‡ä»¤å…³é”®è¯è¦†ç›–ï¼ˆ20%æƒé‡ï¼‰</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="n">extract_instruction_keywords</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span>
    <span class="n">covered</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="k">if</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">response</span><span class="p">)</span>
    <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;keyword_coverage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">covered</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">keywords</span><span class="p">)</span> <span class="k">if</span> <span class="n">keywords</span> <span class="k">else</span> <span class="mf">1.0</span>

    <span class="c1"># 4. ç¦æ­¢å†…å®¹æ£€æŸ¥ï¼ˆ10%æƒé‡ï¼‰</span>
    <span class="k">if</span> <span class="s2">&quot;ä¸è¦æåŠ&quot;</span> <span class="ow">in</span> <span class="n">instruction</span><span class="p">:</span>
        <span class="n">forbidden</span> <span class="o">=</span> <span class="n">extract_forbidden_content</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;constraint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">f</span> <span class="ow">in</span> <span class="n">response</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">forbidden</span><span class="p">)</span> <span class="k">else</span> <span class="mf">1.0</span>

    <span class="c1"># åŠ æƒæ€»åˆ†</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="s1">&#39;relevance&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;keyword_coverage&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;constraint&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}</span>
    <span class="n">final_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">final_score</span><span class="p">,</span> <span class="n">scores</span>
</code></pre></div>

</details>
<p><strong>ç»ƒä¹  7.3ï¼šä¸€è‡´æ€§æ£€éªŒ</strong></p>
<p>ä¸‰ä½æ ‡æ³¨è€…å¯¹ 100 ä¸ª VLM è¾“å‡ºè¿›è¡Œäº† 1-5 åˆ†çš„è´¨é‡è¯„åˆ†ã€‚è¯„åˆ†æ•°æ®å¦‚ä¸‹æ ¼å¼ï¼š</p>
<div class="codehilite"><pre><span></span><code>Item1: [4, 3, 4]  # ä¸‰ä½æ ‡æ³¨è€…çš„è¯„åˆ†
Item2: [5, 5, 4]
...
</code></pre></div>

<p>è¯·è®¡ç®—åˆé€‚çš„ä¸€è‡´æ€§æŒ‡æ ‡å¹¶è§£é‡Šç»“æœã€‚</p>
<p>ğŸ’¡ <strong>æç¤º</strong>ï¼šè€ƒè™‘ä½¿ç”¨ Fleiss' Kappa æˆ– ICCã€‚</p>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>ä½¿ç”¨ Fleiss' Kappa å’Œ ICC è¿›è¡Œä¸€è‡´æ€§åˆ†æï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="k">def</span> <span class="nf">analyze_agreement</span><span class="p">(</span><span class="n">ratings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ratings: shape (n_items, n_raters)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_items</span><span class="p">,</span> <span class="n">n_raters</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n_categories</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># 1-5åˆ†</span>

    <span class="c1"># 1. è®¡ç®— Fleiss&#39; Kappa</span>
    <span class="c1"># æ„å»ºé¢‘ç‡çŸ©é˜µ</span>
    <span class="n">freq_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_items</span><span class="p">,</span> <span class="n">n_categories</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_items</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">freq_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">rating</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># è®¡ç®— P_oï¼ˆè§‚å¯Ÿä¸€è‡´æ€§ï¼‰</span>
    <span class="n">P_o</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_items</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_categories</span><span class="p">):</span>
            <span class="n">P_o</span> <span class="o">+=</span> <span class="n">freq_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">freq_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">P_o</span> <span class="o">=</span> <span class="n">P_o</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_items</span> <span class="o">*</span> <span class="n">n_raters</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_raters</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># è®¡ç®— P_eï¼ˆæœŸæœ›ä¸€è‡´æ€§ï¼‰</span>
    <span class="n">P_e</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_categories</span><span class="p">):</span>
        <span class="n">p_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">freq_matrix</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_items</span> <span class="o">*</span> <span class="n">n_raters</span><span class="p">)</span>
        <span class="n">P_e</span> <span class="o">+=</span> <span class="n">p_j</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="c1"># Fleiss&#39; Kappa</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="p">(</span><span class="n">P_o</span> <span class="o">-</span> <span class="n">P_e</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P_e</span><span class="p">)</span>

    <span class="c1"># 2. è®¡ç®— ICC (Intraclass Correlation Coefficient)</span>
    <span class="c1"># ä½¿ç”¨åŒå‘éšæœºæ•ˆåº”æ¨¡å‹</span>
    <span class="n">icc</span> <span class="o">=</span> <span class="n">calculate_icc</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">icc_type</span><span class="o">=</span><span class="s1">&#39;ICC(2,k)&#39;</span><span class="p">)</span>

    <span class="c1"># 3. è®¡ç®—æ ‡æ³¨è€…é—´çš„é…å¯¹ç›¸å…³æ€§</span>
    <span class="n">correlations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_raters</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_raters</span><span class="p">):</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">ratings</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">ratings</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">correlations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>

    <span class="c1"># è§£é‡Šç»“æœ</span>
    <span class="n">interpretation</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;fleiss_kappa&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">kappa</span><span class="p">,</span>
            <span class="s1">&#39;interpretation&#39;</span><span class="p">:</span> <span class="n">interpret_kappa</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s1">&#39;icc&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">icc</span><span class="p">,</span>
            <span class="s1">&#39;interpretation&#39;</span><span class="p">:</span> <span class="n">interpret_icc</span><span class="p">(</span><span class="n">icc</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s1">&#39;pairwise_correlations&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">correlations</span><span class="p">),</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">correlations</span><span class="p">),</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">correlations</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">interpretation</span>

<span class="k">def</span> <span class="nf">interpret_kappa</span><span class="p">(</span><span class="n">kappa</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;å¾®å¼±ä¸€è‡´æ€§ - éœ€è¦é‡æ–°åŸ¹è®­æ ‡æ³¨è€…&quot;</span>
    <span class="k">elif</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;ä¸€èˆ¬ä¸€è‡´æ€§ - å»ºè®®æ”¹è¿›æ ‡æ³¨æŒ‡å—&quot;</span>
    <span class="k">elif</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;ä¸­ç­‰ä¸€è‡´æ€§ - å¯æ¥å—ä½†æœ‰æ”¹è¿›ç©ºé—´&quot;</span>
    <span class="k">elif</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;è¾ƒå¼ºä¸€è‡´æ€§ - æ ‡æ³¨è´¨é‡è‰¯å¥½&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;æå¼ºä¸€è‡´æ€§ - æ ‡æ³¨è´¨é‡ä¼˜ç§€&quot;</span>
</code></pre></div>

<p><strong>ç»“æœè§£é‡Šï¼š</strong></p>
<ul>
<li>Kappa = 0.65ï¼šä¸­ç­‰åˆ°è¾ƒå¼ºçš„ä¸€è‡´æ€§ï¼Œæ ‡æ³¨è´¨é‡å¯æ¥å—</li>
<li>ICC = 0.72ï¼šè‰¯å¥½çš„ä¿¡åº¦ï¼Œæ ‡æ³¨è€…è¯„åˆ†è¾ƒä¸ºä¸€è‡´</li>
<li>å»ºè®®ï¼šæ£€æŸ¥ä½ä¸€è‡´æ€§çš„å…·ä½“æ¡ˆä¾‹ï¼Œå¯èƒ½éœ€è¦ç»†åŒ–æŸäº›è¯„åˆ†æ ‡å‡†</li>
</ul>
</details>
<h3 id="_2">æŒ‘æˆ˜é¢˜</h3>
<p><strong>ç»ƒä¹  7.4ï¼šå¹»è§‰æ£€æµ‹ç®—æ³•è®¾è®¡</strong></p>
<p>è®¾è®¡ä¸€ä¸ªä¸ä¾èµ–äºç‰©ä½“æ£€æµ‹å™¨çš„å¹»è§‰æ£€æµ‹æ–¹æ³•ã€‚è¯¥æ–¹æ³•åº”è¯¥èƒ½å¤Ÿè¯†åˆ«æ¨¡å‹ç”Ÿæˆçš„æè¿°ä¸­ä¸å­˜åœ¨äºå›¾åƒä¸­çš„å†…å®¹ã€‚</p>
<p>ğŸ’¡ <strong>æç¤º</strong>ï¼šè€ƒè™‘ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶æˆ–å¯¹æ¯”å­¦ä¹ ã€‚</p>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>åŸºäºæ³¨æ„åŠ›æœºåˆ¶å’Œå¯¹æ¯”éªŒè¯çš„å¹»è§‰æ£€æµ‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AttentionBasedHallucinationDetector</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vlm_model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">vlm_model</span>

    <span class="k">def</span> <span class="nf">detect_hallucination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">generated_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        é€šè¿‡åˆ†ææ³¨æ„åŠ›åˆ†å¸ƒæ£€æµ‹å¹»è§‰</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. è·å–ç”Ÿæˆè¿‡ç¨‹ä¸­çš„æ³¨æ„åŠ›æƒé‡</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">generated_text</span><span class="p">)</span>
        <span class="n">attention_maps</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="c1"># è·å–è¯¥ token å¯¹å›¾åƒåŒºåŸŸçš„æ³¨æ„åŠ›</span>
            <span class="n">attn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_cross_attention</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
            <span class="n">attention_maps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attn</span><span class="p">)</span>

        <span class="c1"># 2. è¯†åˆ«å¯èƒ½çš„å¹»è§‰token</span>
        <span class="n">hallucination_scores</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_content_word</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>  <span class="c1"># åªæ£€æŸ¥å®è¯</span>
                <span class="c1"># è®¡ç®—æ³¨æ„åŠ›ç†µï¼ˆåˆ†æ•£åº¦ï¼‰</span>
                <span class="n">entropy</span> <span class="o">=</span> <span class="n">calculate_entropy</span><span class="p">(</span><span class="n">attention_maps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="c1"># é«˜ç†µè¡¨ç¤ºæ³¨æ„åŠ›åˆ†æ•£ï¼Œå¯èƒ½æ˜¯å¹»è§‰</span>
                <span class="k">if</span> <span class="n">entropy</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="c1"># è¿›ä¸€æ­¥éªŒè¯ï¼šé®è”½æµ‹è¯•</span>
                    <span class="n">masked_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masking_test</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">generated_text</span><span class="p">)</span>
                    <span class="n">hallucination_scores</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span>
                        <span class="s1">&#39;entropy&#39;</span><span class="p">:</span> <span class="n">entropy</span><span class="p">,</span>
                        <span class="s1">&#39;masked_score&#39;</span><span class="p">:</span> <span class="n">masked_score</span><span class="p">,</span>
                        <span class="s1">&#39;is_hallucination&#39;</span><span class="p">:</span> <span class="n">masked_score</span> <span class="o">&gt;</span> <span class="mf">0.7</span>
                    <span class="p">})</span>

        <span class="k">return</span> <span class="n">hallucination_scores</span>

    <span class="k">def</span> <span class="nf">masking_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target_token</span><span class="p">,</span> <span class="n">full_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        é®è”½å›¾åƒåŒºåŸŸï¼Œæµ‹è¯•tokençš„ç¨³å®šæ€§</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># è·å–tokençš„ä¸»è¦æ³¨æ„åŠ›åŒºåŸŸ</span>
        <span class="n">attn_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_cross_attention</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">target_token</span><span class="p">)</span>
        <span class="n">top_regions</span> <span class="o">=</span> <span class="n">get_top_k_regions</span><span class="p">(</span><span class="n">attn_map</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># é®è”½è¿™äº›åŒºåŸŸ</span>
        <span class="n">masked_images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">top_regions</span><span class="p">:</span>
            <span class="n">masked_img</span> <span class="o">=</span> <span class="n">mask_region</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
            <span class="n">masked_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">masked_img</span><span class="p">)</span>

        <span class="c1"># æµ‹è¯•ç”Ÿæˆçš„ä¸€è‡´æ€§</span>
        <span class="n">consistency_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">masked_img</span> <span class="ow">in</span> <span class="n">masked_images</span><span class="p">:</span>
            <span class="n">new_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">masked_img</span><span class="p">,</span> <span class="n">same_prompt</span><span class="p">)</span>
            <span class="c1"># å¦‚æœé®è”½åä»ç„¶ç”Ÿæˆç›¸åŒçš„tokenï¼Œå¯èƒ½æ˜¯å¹»è§‰</span>
            <span class="k">if</span> <span class="n">target_token</span> <span class="ow">in</span> <span class="n">new_text</span><span class="p">:</span>
                <span class="n">consistency_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">consistency_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">consistency_scores</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">contrastive_verification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">claim</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        é€šè¿‡ç”Ÿæˆå¯¹æ¯”é—®é¢˜éªŒè¯å£°æ˜</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ç”ŸæˆéªŒè¯é—®é¢˜</span>
        <span class="n">verification_questions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;å›¾åƒä¸­æ˜¯å¦æœ‰</span><span class="si">{</span><span class="n">extract_object</span><span class="p">(</span><span class="n">claim</span><span class="p">)</span><span class="si">}</span><span class="s2">ï¼Ÿ&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">extract_object</span><span class="p">(</span><span class="n">claim</span><span class="p">)</span><span class="si">}</span><span class="s2">çš„é¢œè‰²æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">extract_object</span><span class="p">(</span><span class="n">claim</span><span class="p">)</span><span class="si">}</span><span class="s2">åœ¨å›¾åƒçš„å“ªä¸ªä½ç½®ï¼Ÿ&quot;</span>
        <span class="p">]</span>

        <span class="n">confidence_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">verification_questions</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">answer</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
            <span class="c1"># åˆ†æå›ç­”çš„ç¡®å®šæ€§</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">analyze_answer_confidence</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
            <span class="n">confidence_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confidence</span><span class="p">)</span>

        <span class="c1"># ä½ç½®ä¿¡åº¦å¯èƒ½è¡¨ç¤ºå¹»è§‰</span>
        <span class="n">avg_confidence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">confidence_scores</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">avg_confidence</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
</code></pre></div>

<p><strong>åˆ›æ–°ç‚¹ï¼š</strong></p>
<ol>
<li>ä¸ä¾èµ–å¤–éƒ¨ç‰©ä½“æ£€æµ‹å™¨</li>
<li>ç»“åˆæ³¨æ„åŠ›æœºåˆ¶åˆ†æå’Œé®è”½æµ‹è¯•</li>
<li>ä½¿ç”¨å¯¹æ¯”éªŒè¯å¢å¼ºå‡†ç¡®æ€§</li>
<li>å¯è§£é‡Šæ€§å¼ºï¼Œèƒ½å®šä½å…·ä½“çš„å¹»è§‰å†…å®¹</li>
</ol>
</details>
<p><strong>ç»ƒä¹  7.5ï¼šåœ¨çº¿ A/B æµ‹è¯•è®¾è®¡</strong></p>
<p>ä½ éœ€è¦è®¾è®¡ä¸€ä¸ª A/B æµ‹è¯•æ¥è¯„ä¼°æ–°çš„ VLM æ¨¡å‹æ˜¯å¦åº”è¯¥æ›¿æ¢ç°æœ‰æ¨¡å‹ã€‚ç³»ç»Ÿæ¯å¤©å¤„ç† 100 ä¸‡ä¸ªè¯·æ±‚ï¼Œä¸»è¦æŒ‡æ ‡æ˜¯ç”¨æˆ·æ»¡æ„åº¦ï¼ˆé€šè¿‡ç‚¹å‡»ç‡è¡¡é‡ï¼‰ã€‚è®¾è®¡å®Œæ•´çš„æµ‹è¯•æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ ·æœ¬é‡è®¡ç®—ã€æµ‹è¯•æ—¶é•¿å’Œå†³ç­–æ ‡å‡†ã€‚</p>
<p>ğŸ’¡ <strong>æç¤º</strong>ï¼šè€ƒè™‘ç»Ÿè®¡åŠŸæ•ˆã€æœ€å°å¯æ£€æµ‹æ•ˆåº”å’Œä¸šåŠ¡å½±å“ã€‚</p>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>å®Œæ•´çš„ A/B æµ‹è¯•æ–¹æ¡ˆè®¾è®¡ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">VLMABTestDesign</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daily_traffic</span> <span class="o">=</span> <span class="mi">1_000_000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_ctr</span> <span class="o">=</span> <span class="mf">0.15</span>  <span class="c1"># 15% åŸºå‡†ç‚¹å‡»ç‡</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_detectable_effect</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># 1% ç»å¯¹æå‡</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># æ˜¾è‘—æ€§æ°´å¹³</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="mf">0.8</span>   <span class="c1"># ç»Ÿè®¡åŠŸæ•ˆ</span>

    <span class="k">def</span> <span class="nf">calculate_sample_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è®¡ç®—æ‰€éœ€æ ·æœ¬é‡</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">statsmodels.stats.power</span> <span class="kn">import</span> <span class="n">zt_ind_solve_power</span>

        <span class="c1"># æ•ˆåº”é‡è®¡ç®—</span>
        <span class="n">effect_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_detectable_effect</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseline_ctr</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_ctr</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># æ¯ç»„æ‰€éœ€æ ·æœ¬é‡</span>
        <span class="n">n_per_group</span> <span class="o">=</span> <span class="n">zt_ind_solve_power</span><span class="p">(</span>
            <span class="n">effect_size</span><span class="o">=</span><span class="n">effect_size</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">power</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">,</span>
            <span class="n">ratio</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span>
        <span class="p">)</span>

        <span class="n">total_sample</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_per_group</span>
        <span class="n">days_needed</span> <span class="o">=</span> <span class="n">total_sample</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daily_traffic</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># 10%æµé‡ç”¨äºæµ‹è¯•</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;sample_per_group&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_per_group</span><span class="p">),</span>
            <span class="s1">&#39;total_sample&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_sample</span><span class="p">),</span>
            <span class="s1">&#39;days_needed&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">days_needed</span><span class="p">),</span>
            <span class="s1">&#39;daily_test_traffic&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daily_traffic</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">design_test_plan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è®¾è®¡å®Œæ•´æµ‹è¯•è®¡åˆ’</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sample_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_sample_size</span><span class="p">()</span>

        <span class="n">test_plan</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;é˜¶æ®µ1ï¼šå°æµé‡éªŒè¯ï¼ˆç¬¬1-3å¤©ï¼‰&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;traffic_percentage&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;daily_users&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
                <span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;éªŒè¯ç³»ç»Ÿç¨³å®šæ€§ï¼Œå‘ç°ä¸¥é‡é—®é¢˜&#39;</span><span class="p">,</span>
                <span class="s1">&#39;success_criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;æ— ç³»ç»Ÿå´©æºƒï¼Œé”™è¯¯ç‡&lt;1%&#39;</span><span class="p">,</span>
                <span class="s1">&#39;monitors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;é”™è¯¯ç‡&#39;</span><span class="p">,</span> <span class="s1">&#39;å»¶è¿ŸP99&#39;</span><span class="p">,</span> <span class="s1">&#39;èµ„æºä½¿ç”¨&#39;</span><span class="p">]</span>
            <span class="p">},</span>

            <span class="s1">&#39;é˜¶æ®µ2ï¼šæ­£å¼å®éªŒï¼ˆç¬¬4-14å¤©ï¼‰&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;traffic_percentage&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;daily_users&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span>
                <span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;æ”¶é›†ç»Ÿè®¡æ˜¾è‘—çš„ç»“æœ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;success_criteria&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;CTRæå‡&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_detectable_effect</span><span class="si">}</span><span class="s1">ï¼Œp&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;monitors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;CTR&#39;</span><span class="p">,</span> <span class="s1">&#39;ç”¨æˆ·æ»¡æ„åº¦&#39;</span><span class="p">,</span> <span class="s1">&#39;åœç•™æ—¶é•¿&#39;</span><span class="p">,</span> <span class="s1">&#39;è·³å‡ºç‡&#39;</span><span class="p">]</span>
            <span class="p">},</span>

            <span class="s1">&#39;é˜¶æ®µ3ï¼šæ‰©å¤§éªŒè¯ï¼ˆç¬¬15-21å¤©ï¼‰&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;traffic_percentage&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                <span class="s1">&#39;daily_users&#39;</span><span class="p">:</span> <span class="mi">300000</span><span class="p">,</span>
                <span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="s1">&#39;éªŒè¯ä¸åŒç”¨æˆ·ç¾¤ä½“çš„æ•ˆæœ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;success_criteria&#39;</span><span class="p">:</span> <span class="s1">&#39;å„ç»†åˆ†ç¾¤ä½“å‡æ— è´Ÿå‘å½±å“&#39;</span><span class="p">,</span>
                <span class="s1">&#39;monitors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;åˆ†ç¾¤ä½“CTR&#39;</span><span class="p">,</span> <span class="s1">&#39;åœ°åŸŸå·®å¼‚&#39;</span><span class="p">,</span> <span class="s1">&#39;æ–°è€ç”¨æˆ·å·®å¼‚&#39;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">test_plan</span>

    <span class="k">def</span> <span class="nf">define_decision_criteria</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        å®šä¹‰å†³ç­–æ ‡å‡†</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;å‘å¸ƒå†³ç­–&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;å¼ºçƒˆæ¨èå‘å¸ƒ&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s1">&#39;CTR æå‡ &gt; 2%&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;p-value &lt; 0.01&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;æ‰€æœ‰ç»†åˆ†ç¾¤ä½“å‡æ­£å‘&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ç”¨æˆ·æŠ•è¯‰ä¸‹é™&#39;</span>
                <span class="p">],</span>
                <span class="s1">&#39;æ¨èå‘å¸ƒ&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s1">&#39;CTR æå‡ &gt; 1%&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;p-value &lt; 0.05&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ä¸»è¦ç¾¤ä½“æ­£å‘&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;æ— ä¸¥é‡è´Ÿé¢åé¦ˆ&#39;</span>
                <span class="p">],</span>
                <span class="s1">&#39;æš‚ç¼“å‘å¸ƒ&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s1">&#39;CTR æå‡ &lt; 1%&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;p-value &gt; 0.05&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;æˆ–å­˜åœ¨ç»†åˆ†ç¾¤ä½“è´Ÿå‘&#39;</span>
                <span class="p">],</span>
                <span class="s1">&#39;åœæ­¢å‘å¸ƒ&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s1">&#39;CTR ä¸‹é™&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ä¸¥é‡æ€§èƒ½é—®é¢˜&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ç”¨æˆ·æŠ•è¯‰æ¿€å¢&#39;</span>
                <span class="p">]</span>
            <span class="p">},</span>

            <span class="s1">&#39;æŠ¤æ æŒ‡æ ‡&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;æ€§èƒ½æŠ¤æ &#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;P95_latency&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;500ms&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;error_rate&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;0.1%&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;gpu_utilization&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;80%&#39;</span>
                <span class="p">},</span>
                <span class="s1">&#39;ä¸šåŠ¡æŠ¤æ &#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;revenue_impact&#39;</span><span class="p">:</span> <span class="s1">&#39;&gt;-1%&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;user_complaints&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;2x baseline&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;retention_rate&#39;</span><span class="p">:</span> <span class="s1">&#39;&gt;98%&#39;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">criteria</span>

    <span class="k">def</span> <span class="nf">monitoring_dashboard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ç›‘æ§ä»ªè¡¨æ¿è®¾è®¡</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dashboard</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;å®æ—¶ç›‘æ§&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;åˆ†ç»„æµé‡åˆ†é…æ¯”ä¾‹&#39;</span><span class="p">,</span>
                <span class="s1">&#39;å®æ—¶ CTR å¯¹æ¯”&#39;</span><span class="p">,</span>
                <span class="s1">&#39;å»¶è¿Ÿåˆ†å¸ƒ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;é”™è¯¯ç‡è¶‹åŠ¿&#39;</span>
            <span class="p">],</span>

            <span class="s1">&#39;æ¯æ—¥æŠ¥å‘Š&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;ç´¯è®¡æ ·æœ¬é‡å’Œç»Ÿè®¡åŠŸæ•ˆ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;CTR æå‡åŠç½®ä¿¡åŒºé—´&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ç»†åˆ†ç»´åº¦åˆ†æ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;å¼‚å¸¸æ¡ˆä¾‹æ±‡æ€»&#39;</span>
            <span class="p">],</span>

            <span class="s1">&#39;å†³ç­–æ”¯æŒ&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;é¢„è®¡å®Œæˆæ—¶é—´&#39;</span><span class="p">,</span>
                <span class="s1">&#39;å½“å‰ç»Ÿè®¡æ˜¾è‘—æ€§&#39;</span><span class="p">,</span>
                <span class="s1">&#39;æå‰åœæ­¢å»ºè®®&#39;</span><span class="p">,</span>
                <span class="s1">&#39;å‘å¸ƒé£é™©è¯„ä¼°&#39;</span>
            <span class="p">]</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">dashboard</span>
</code></pre></div>

<p><strong>å…³é”®å†³ç­–ç‚¹ï¼š</strong></p>
<ol>
<li><strong>æ ·æœ¬é‡</strong>ï¼šçº¦ 294,000 per groupï¼Œéœ€è¦ 6 å¤©è¾¾åˆ°ç»Ÿè®¡æ˜¾è‘—</li>
<li><strong>æµ‹è¯•æ—¶é•¿</strong>ï¼šå»ºè®® 21 å¤©å®Œæ•´å‘¨æœŸï¼Œè¦†ç›–ä¸åŒä½¿ç”¨æ¨¡å¼</li>
<li><strong>æµé‡åˆ†é…</strong>ï¼šæ¸è¿›å¼ï¼Œ1% â†’ 10% â†’ 30%</li>
<li><strong>å†³ç­–æ ‡å‡†</strong>ï¼šç»¼åˆè€ƒè™‘ç»Ÿè®¡æ˜¾è‘—æ€§å’Œä¸šåŠ¡å½±å“</li>
<li><strong>é£é™©æ§åˆ¶</strong>ï¼šè®¾ç½®å¤šå±‚æŠ¤æ ï¼Œæ”¯æŒå¿«é€Ÿå›æ»š</li>
</ol>
</details>
<p><strong>ç»ƒä¹  7.6ï¼šè·¨æ¨¡æ€ä¸€è‡´æ€§è¯„ä¼°</strong></p>
<p>è®¾è®¡ä¸€ä¸ªè¯„ä¼°æ¡†æ¶ï¼Œç”¨äºæ£€æµ‹ VLM åœ¨å¤„ç†åŒä¸€å†…å®¹çš„ä¸åŒæ¨¡æ€è¡¨ç¤ºæ—¶çš„ä¸€è‡´æ€§ï¼ˆä¾‹å¦‚ï¼šå›¾è¡¨çš„å›¾åƒç‰ˆæœ¬ vs æ•°æ®è¡¨æ ¼ï¼‰ã€‚</p>
<p>ğŸ’¡ <strong>æç¤º</strong>ï¼šè€ƒè™‘å¦‚ä½•ç”Ÿæˆç­‰ä»·çš„å¤šæ¨¡æ€è¾“å…¥ã€‚</p>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>è·¨æ¨¡æ€ä¸€è‡´æ€§è¯„ä¼°æ¡†æ¶ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CrossModalConsistencyEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modality_pairs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;image_chart&#39;</span><span class="p">,</span> <span class="s1">&#39;data_table&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;text_description&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;diagram&#39;</span><span class="p">,</span> <span class="s1">&#39;structured_text&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;screenshot&#39;</span><span class="p">,</span> <span class="s1">&#39;html_dom&#39;</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">generate_equivalent_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">source_modality</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ç”Ÿæˆç­‰ä»·çš„å¤šæ¨¡æ€è¾“å…¥</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">source_modality</span> <span class="o">==</span> <span class="s1">&#39;data_table&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;bar_chart&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_to_bar_chart</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                <span class="s1">&#39;line_chart&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_to_line_chart</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                <span class="s1">&#39;pie_chart&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_to_pie_chart</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                <span class="s1">&#39;text_summary&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_to_text</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">source_modality</span> <span class="o">==</span> <span class="s1">&#39;image&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;text_description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_to_text</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                <span class="s1">&#39;structured_data&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_to_structured</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
                <span class="s1">&#39;sketch&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_to_sketch</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="c1"># ... å…¶ä»–æ¨¡æ€è½¬æ¢</span>

    <span class="k">def</span> <span class="nf">evaluate_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">question</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è¯„ä¼°è·¨æ¨¡æ€ä¸€è‡´æ€§</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ç”Ÿæˆå¤šæ¨¡æ€ç‰ˆæœ¬</span>
        <span class="n">modalities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_equivalent_inputs</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;original&#39;</span><span class="p">)</span>

        <span class="n">responses</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># è·å–å„æ¨¡æ€çš„å“åº”</span>
        <span class="k">for</span> <span class="n">modality_name</span><span class="p">,</span> <span class="n">modality_content</span> <span class="ow">in</span> <span class="n">modalities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">modality_content</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
            <span class="n">responses</span><span class="p">[</span><span class="n">modality_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span>

            <span class="c1"># è·å–è¯­ä¹‰åµŒå…¥</span>
            <span class="n">embedding</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_embedding</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">embeddings</span><span class="p">[</span><span class="n">modality_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">embedding</span>

        <span class="c1"># è®¡ç®—ä¸€è‡´æ€§æŒ‡æ ‡</span>
        <span class="n">consistency_metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;semantic_similarity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_semantic_consistency</span><span class="p">(</span><span class="n">embeddings</span><span class="p">),</span>
            <span class="s1">&#39;answer_agreement&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_answer_agreement</span><span class="p">(</span><span class="n">responses</span><span class="p">),</span>
            <span class="s1">&#39;information_preservation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_info_preservation</span><span class="p">(</span><span class="n">responses</span><span class="p">),</span>
            <span class="s1">&#39;confidence_stability&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_confidence_stability</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">consistency_metrics</span>

    <span class="k">def</span> <span class="nf">compute_semantic_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è®¡ç®—è¯­ä¹‰ä¸€è‡´æ€§</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">similarities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">modalities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">embeddings</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">modalities</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">modalities</span><span class="p">)):</span>
                <span class="n">sim</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span>
                    <span class="n">embeddings</span><span class="p">[</span><span class="n">modalities</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> 
                    <span class="n">embeddings</span><span class="p">[</span><span class="n">modalities</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                <span class="p">)</span>
                <span class="n">similarities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;mean_similarity&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">similarities</span><span class="p">),</span>
            <span class="s1">&#39;min_similarity&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">similarities</span><span class="p">),</span>
            <span class="s1">&#39;std_similarity&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">similarities</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">identify_inconsistency_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è¯†åˆ«ä¸ä¸€è‡´æ¨¡å¼</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;modality_bias&#39;</span><span class="p">:</span> <span class="p">{},</span>  <span class="c1"># ç‰¹å®šæ¨¡æ€çš„åå¥½</span>
            <span class="s1">&#39;information_loss&#39;</span><span class="p">:</span> <span class="p">{},</span>  <span class="c1"># ä¿¡æ¯ä¸¢å¤±æ¨¡å¼</span>
            <span class="s1">&#39;systematic_errors&#39;</span><span class="p">:</span> <span class="p">[]</span>  <span class="c1"># ç³»ç»Ÿæ€§é”™è¯¯</span>
        <span class="p">}</span>

        <span class="c1"># åˆ†ææ¯ç§æ¨¡æ€è½¬æ¢çš„ä¸€è‡´æ€§</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modality_pairs</span><span class="p">:</span>
            <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span> <span class="o">=</span> <span class="n">pair</span>
            <span class="n">consistency</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s1">_to_</span><span class="si">{</span><span class="n">tgt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">consistency</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
                <span class="n">patterns</span><span class="p">[</span><span class="s1">&#39;modality_bias&#39;</span><span class="p">][</span><span class="n">pair</span><span class="p">]</span> <span class="o">=</span> <span class="n">consistency</span>

                <span class="c1"># æ·±å…¥åˆ†æä¸ä¸€è‡´åŸå› </span>
                <span class="k">if</span> <span class="n">src</span> <span class="o">==</span> <span class="s1">&#39;image_chart&#39;</span> <span class="ow">and</span> <span class="n">tgt</span> <span class="o">==</span> <span class="s1">&#39;data_table&#39;</span><span class="p">:</span>
                    <span class="c1"># å›¾è¡¨è¯†åˆ«å¯èƒ½çš„é—®é¢˜</span>
                    <span class="n">issues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_chart_recognition_issues</span><span class="p">()</span>
                    <span class="n">patterns</span><span class="p">[</span><span class="s1">&#39;systematic_errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">issues</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">patterns</span>

    <span class="k">def</span> <span class="nf">generate_test_suite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ç”Ÿæˆæµ‹è¯•å¥—ä»¶</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">test_cases</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># 1. æ•°å€¼ä¸€è‡´æ€§æµ‹è¯•</span>
        <span class="n">test_cases</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;æ•°å€¼æå–ä¸€è‡´æ€§&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;chart_image&#39;</span><span class="p">:</span> <span class="n">create_bar_chart</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]),</span>
                <span class="s1">&#39;data_table&#39;</span><span class="p">:</span> <span class="n">create_table</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
            <span class="p">},</span>
            <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="s1">&#39;æœ€å¤§å€¼æ˜¯å¤šå°‘ï¼Ÿ&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expected_consistency&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">})</span>

        <span class="c1"># 2. è¶‹åŠ¿è¯†åˆ«ä¸€è‡´æ€§</span>
        <span class="n">test_cases</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;è¶‹åŠ¿åˆ†æä¸€è‡´æ€§&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;line_chart&#39;</span><span class="p">:</span> <span class="n">create_trend_chart</span><span class="p">(),</span>
                <span class="s1">&#39;text_description&#39;</span><span class="p">:</span> <span class="n">create_trend_description</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="s1">&#39;æ•°æ®å‘ˆç°ä»€ä¹ˆè¶‹åŠ¿ï¼Ÿ&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expected_consistency&#39;</span><span class="p">:</span> <span class="mf">0.9</span>
        <span class="p">})</span>

        <span class="c1"># 3. å…³ç³»ç†è§£ä¸€è‡´æ€§</span>
        <span class="n">test_cases</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ç©ºé—´å…³ç³»ä¸€è‡´æ€§&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;scene_image&#39;</span><span class="p">:</span> <span class="n">create_scene_image</span><span class="p">(),</span>
                <span class="s1">&#39;scene_graph&#39;</span><span class="p">:</span> <span class="n">create_scene_graph</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="s1">&#39;ç‰©ä½“ä¹‹é—´çš„ä½ç½®å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expected_consistency&#39;</span><span class="p">:</span> <span class="mf">0.85</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">test_cases</span>
</code></pre></div>

<p><strong>è¯„ä¼°ç»´åº¦ï¼š</strong></p>
<ol>
<li><strong>è¯­ä¹‰ä¸€è‡´æ€§</strong>ï¼šä¸åŒæ¨¡æ€è¡¨è¾¾çš„è¯­ä¹‰æ˜¯å¦ä¸€è‡´</li>
<li><strong>æ•°å€¼å‡†ç¡®æ€§</strong>ï¼šä»å›¾è¡¨å’Œè¡¨æ ¼æå–çš„æ•°å€¼æ˜¯å¦ç›¸åŒ</li>
<li><strong>å…³ç³»ä¿æŒ</strong>ï¼šå®ä½“å…³ç³»åœ¨ä¸åŒæ¨¡æ€ä¸­æ˜¯å¦ä¿æŒ</li>
<li><strong>ç½®ä¿¡åº¦ç¨³å®šæ€§</strong>ï¼šæ¨¡å‹å¯¹ä¸åŒæ¨¡æ€è¾“å…¥çš„ç¡®å®šæ€§æ˜¯å¦ä¸€è‡´</li>
</ol>
</details>
<p><strong>ç»ƒä¹  7.7ï¼šè¯„ä¼°æˆæœ¬ä¼˜åŒ–</strong></p>
<p>ä½ çš„å›¢é˜Ÿæ¯æœˆéœ€è¦è¯„ä¼° 10 ä¸ª VLM æ¨¡å‹ç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬åœ¨ 5 ä¸ªåŸºå‡†æµ‹è¯•ä¸Šè¯„ä¼°ï¼ˆå…± 50K æ ·æœ¬ï¼‰ï¼ŒåŒæ—¶éœ€è¦ 1000 ä¸ªæ ·æœ¬çš„äººå·¥è¯„ä¼°ã€‚å½“å‰æ¯æœˆè¯„ä¼°æˆæœ¬ä¸º $50,000ã€‚è®¾è®¡ä¸€ä¸ªæ–¹æ¡ˆå°†æˆæœ¬é™ä½ 50% è€Œä¸æ˜¾è‘—å½±å“è¯„ä¼°è´¨é‡ã€‚</p>
<p>ğŸ’¡ <strong>æç¤º</strong>ï¼šè€ƒè™‘é‡‡æ ·ç­–ç•¥ã€è¯„ä¼°å¤ç”¨å’Œè‡ªåŠ¨åŒ–ã€‚</p>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>è¯„ä¼°æˆæœ¬ä¼˜åŒ–æ–¹æ¡ˆï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EvaluationCostOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_cost</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;compute&#39;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>  <span class="c1"># GPU è®¡ç®—æˆæœ¬</span>
            <span class="s1">&#39;human&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span>    <span class="c1"># äººå·¥æ ‡æ³¨æˆæœ¬</span>
            <span class="s1">&#39;api&#39;</span><span class="p">:</span> <span class="mi">5000</span>        <span class="c1"># API è°ƒç”¨æˆæœ¬ï¼ˆGPT-4Vè¯„ä¼°ï¼‰</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_cost</span> <span class="o">=</span> <span class="mi">25000</span>  <span class="c1"># ç›®æ ‡æˆæœ¬</span>

    <span class="k">def</span> <span class="nf">optimization_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        å¤šç»´åº¦ä¼˜åŒ–ç­–ç•¥</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strategies</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;1. æ™ºèƒ½é‡‡æ ·ç­–ç•¥&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">smart_sampling</span><span class="p">(),</span>
            <span class="s1">&#39;2. è¯„ä¼°å¤ç”¨æœºåˆ¶&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_reuse</span><span class="p">(),</span>
            <span class="s1">&#39;3. åˆ†å±‚è¯„ä¼°æµç¨‹&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiered_evaluation</span><span class="p">(),</span>
            <span class="s1">&#39;4. è‡ªåŠ¨åŒ–é¢„ç­›é€‰&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">automated_prescreening</span><span class="p">(),</span>
            <span class="s1">&#39;5. èµ„æºè°ƒåº¦ä¼˜åŒ–&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_optimization</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">strategies</span>

    <span class="k">def</span> <span class="nf">smart_sampling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æ™ºèƒ½é‡‡æ ·å‡å°‘è¯„ä¼°é‡</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;æ–¹æ³•&#39;</span><span class="p">:</span> <span class="s1">&#39;è‡ªé€‚åº”é‡è¦æ€§é‡‡æ ·&#39;</span><span class="p">,</span>
            <span class="s1">&#39;å®ç°&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            class AdaptiveSampler:</span>
<span class="s1">                def __init__(self, full_dataset):</span>
<span class="s1">                    self.dataset = full_dataset</span>
<span class="s1">                    self.difficulty_scores = self.estimate_difficulty()</span>

<span class="s1">                def sample(self, n_samples, model_capability):</span>
<span class="s1">                    # æ ¹æ®æ¨¡å‹èƒ½åŠ›è°ƒæ•´é‡‡æ ·åˆ†å¸ƒ</span>
<span class="s1">                    if model_capability &gt; 0.8:</span>
<span class="s1">                        # å¼ºæ¨¡å‹ï¼šæ›´å¤šå›°éš¾æ ·æœ¬</span>
<span class="s1">                        weights = self.difficulty_scores ** 2</span>
<span class="s1">                    else:</span>
<span class="s1">                        # å¼±æ¨¡å‹ï¼šå‡è¡¡é‡‡æ ·</span>
<span class="s1">                        weights = np.ones_like(self.difficulty_scores)</span>

<span class="s1">                    # åˆ†å±‚é‡‡æ ·ç¡®ä¿è¦†ç›–</span>
<span class="s1">                    strata = self.create_strata()</span>
<span class="s1">                    samples = []</span>
<span class="s1">                    for stratum in strata:</span>
<span class="s1">                        n_stratum = int(n_samples * stratum.weight)</span>
<span class="s1">                        stratum_samples = self.weighted_sample(</span>
<span class="s1">                            stratum.items, </span>
<span class="s1">                            weights[stratum.indices], </span>
<span class="s1">                            n_stratum</span>
<span class="s1">                        )</span>
<span class="s1">                        samples.extend(stratum_samples)</span>

<span class="s1">                    return samples</span>

<span class="s1">                def estimate_difficulty(self):</span>
<span class="s1">                    # åŸºäºå†å²æ¨¡å‹è¡¨ç°ä¼°è®¡éš¾åº¦</span>
<span class="s1">                    return historical_error_rates</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;é¢„æœŸèŠ‚çœ&#39;</span><span class="p">:</span> <span class="s1">&#39;40% æ ·æœ¬é‡ï¼Œä¿æŒ 95% è¯„ä¼°å‡†ç¡®åº¦&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">evaluation_reuse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è¯„ä¼°ç»“æœå¤ç”¨</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;æ–¹æ³•&#39;</span><span class="p">:</span> <span class="s1">&#39;å¢é‡è¯„ä¼° + ç»“æœç¼“å­˜&#39;</span><span class="p">,</span>
            <span class="s1">&#39;å®ç°&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            class IncrementalEvaluator:</span>
<span class="s1">                def __init__(self):</span>
<span class="s1">                    self.cache = EvaluationCache()</span>

<span class="s1">                def evaluate_model(self, model_version, benchmarks):</span>
<span class="s1">                    results = </span><span class="si">{}</span>

<span class="s1">                    # æ£€æµ‹æ¨¡å‹å˜åŒ–</span>
<span class="s1">                    changes = self.detect_changes(model_version)</span>

<span class="s1">                    for benchmark in benchmarks:</span>
<span class="s1">                        if self.can_reuse(model_version, benchmark, changes):</span>
<span class="s1">                            # å¤ç”¨ä¹‹å‰ç‰ˆæœ¬çš„ç»“æœ</span>
<span class="s1">                            cached = self.cache.get(model_version.base, benchmark)</span>

<span class="s1">                            # åªè¯„ä¼°å¯èƒ½å—å½±å“çš„å­é›†</span>
<span class="s1">                            affected_samples = self.get_affected_samples(changes, benchmark)</span>
<span class="s1">                            new_results = model_version.evaluate(affected_samples)</span>

<span class="s1">                            # åˆå¹¶ç»“æœ</span>
<span class="s1">                            results[benchmark] = self.merge_results(cached, new_results)</span>
<span class="s1">                        else:</span>
<span class="s1">                            # å®Œæ•´è¯„ä¼°</span>
<span class="s1">                            results[benchmark] = model_version.evaluate(benchmark)</span>

<span class="s1">                    self.cache.store(model_version, results)</span>
<span class="s1">                    return results</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;é¢„æœŸèŠ‚çœ&#39;</span><span class="p">:</span> <span class="s1">&#39;60% é‡å¤è¯„ä¼°æˆæœ¬&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">tiered_evaluation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        åˆ†å±‚è¯„ä¼°æµç¨‹</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;æ–¹æ³•&#39;</span><span class="p">:</span> <span class="s1">&#39;å¿«é€Ÿç­›é€‰ â†’ è¯¦ç»†è¯„ä¼°&#39;</span><span class="p">,</span>
            <span class="s1">&#39;æµç¨‹&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            Level 1: å¿«é€Ÿç­›é€‰ï¼ˆ500 æ ·æœ¬ï¼Œ5 åˆ†é’Ÿï¼‰</span>
<span class="s1">            â”œâ”€â”€ å¦‚æœæ€§èƒ½ä¸‹é™ &gt; 5% â†’ åœæ­¢ï¼Œä¸éœ€è¦å®Œæ•´è¯„ä¼°</span>
<span class="s1">            â”œâ”€â”€ å¦‚æœæ€§èƒ½æå‡ &lt; 1% â†’ åœæ­¢ï¼Œæ”¹è¿›ä¸æ˜æ˜¾</span>
<span class="s1">            â””â”€â”€ å¦åˆ™ â†’ è¿›å…¥ Level 2</span>

<span class="s1">            Level 2: æ ‡å‡†è¯„ä¼°ï¼ˆ5K æ ·æœ¬ï¼Œ1 å°æ—¶ï¼‰</span>
<span class="s1">            â”œâ”€â”€ å¦‚æœè¾¾åˆ°å‘å¸ƒæ ‡å‡† â†’ è¿›å…¥ Level 3</span>
<span class="s1">            â””â”€â”€ å¦åˆ™ â†’ è¿”å›å¼€å‘</span>

<span class="s1">            Level 3: å®Œæ•´è¯„ä¼°ï¼ˆ50K æ ·æœ¬ + äººå·¥ï¼‰</span>
<span class="s1">            â””â”€â”€ åªå¯¹å€™é€‰å‘å¸ƒç‰ˆæœ¬æ‰§è¡Œ</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;é¢„æœŸèŠ‚çœ&#39;</span><span class="p">:</span> <span class="s1">&#39;70% çš„æ¨¡å‹åœ¨ Level 1/2 è¢«è¿‡æ»¤&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">automated_prescreening</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è‡ªåŠ¨åŒ–é¢„ç­›é€‰</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;æ–¹æ³•&#39;</span><span class="p">:</span> <span class="s1">&#39;ç”¨å°æ¨¡å‹é¢„ç­›é€‰ + GPT-4V æŠ½æ£€&#39;</span><span class="p">,</span>
            <span class="s1">&#39;å®ç°&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            class HybridEvaluator:</span>
<span class="s1">                def __init__(self):</span>
<span class="s1">                    self.small_model = load_model(&#39;llava-1.5-7b&#39;)  # ä¾¿å®œ</span>
<span class="s1">                    self.large_model = load_model(&#39;gpt-4v&#39;)  # æ˜‚è´µä½†å‡†ç¡®</span>

<span class="s1">                def evaluate(self, samples):</span>
<span class="s1">                    # Step 1: å°æ¨¡å‹å…¨é‡è¯„ä¼°</span>
<span class="s1">                    small_results = self.small_model.evaluate_all(samples)</span>

<span class="s1">                    # Step 2: è¯†åˆ«åˆ†æ­§æ ·æœ¬</span>
<span class="s1">                    uncertain_samples = self.identify_uncertain(small_results)</span>

<span class="s1">                    # Step 3: å¤§æ¨¡å‹æŠ½æ£€</span>
<span class="s1">                    # åªå¯¹ 20% ä¸ç¡®å®šæ ·æœ¬ä½¿ç”¨ GPT-4V</span>
<span class="s1">                    large_results = self.large_model.evaluate(uncertain_samples)</span>

<span class="s1">                    # Step 4: æ ¡å‡†å°æ¨¡å‹ç»“æœ</span>
<span class="s1">                    calibrated = self.calibrate_results(</span>
<span class="s1">                        small_results, </span>
<span class="s1">                        large_results, </span>
<span class="s1">                        uncertain_samples</span>
<span class="s1">                    )</span>

<span class="s1">                    return calibrated</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;é¢„æœŸèŠ‚çœ&#39;</span><span class="p">:</span> <span class="s1">&#39;80% API è°ƒç”¨æˆæœ¬&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">resource_optimization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        èµ„æºè°ƒåº¦ä¼˜åŒ–</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;æ–¹æ³•&#39;</span><span class="p">:</span> <span class="s1">&#39;æ‰¹å¤„ç† + é¢„çº¦è°ƒåº¦ + ç‚¹ä»·ç­–ç•¥&#39;</span><span class="p">,</span>
            <span class="s1">&#39;å…·ä½“æªæ–½&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;æ‰¹é‡å¤„ç†ï¼šç§¯ç´¯ä»»åŠ¡ç»Ÿä¸€æ‰§è¡Œï¼Œæé«˜ GPU åˆ©ç”¨ç‡&#39;</span><span class="p">,</span>
                <span class="s1">&#39;é”™å³°è°ƒåº¦ï¼šä½¿ç”¨å¤œé—´/å‘¨æœ«çš„ä¾¿å®œç®—åŠ›&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ç«ä»·å®ä¾‹ï¼šéç´§æ€¥è¯„ä¼°ä½¿ç”¨ Spot å®ä¾‹&#39;</span><span class="p">,</span>
                <span class="s1">&#39;æ¨¡å‹é‡åŒ–ï¼šè¯„ä¼°æ—¶ä½¿ç”¨é‡åŒ–æ¨¡å‹ï¼ˆéªŒè¯ç²¾åº¦æŸå¤± &lt;1%ï¼‰&#39;</span>
            <span class="p">],</span>
            <span class="s1">&#39;é¢„æœŸèŠ‚çœ&#39;</span><span class="p">:</span> <span class="s1">&#39;30% è®¡ç®—æˆæœ¬&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">cost_breakdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ä¼˜åŒ–åæˆæœ¬åˆ†è§£</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">optimized_cost</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;è®¡ç®—æˆæœ¬&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;åŸå§‹&#39;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>
                <span class="s1">&#39;ä¼˜åŒ–å&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span>
                <span class="s1">&#39;æªæ–½&#39;</span><span class="p">:</span> <span class="s1">&#39;æ™ºèƒ½é‡‡æ ·(40%) + é‡åŒ–(20%) + Spotå®ä¾‹(20%)&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;äººå·¥æˆæœ¬&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;åŸå§‹&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span>
                <span class="s1">&#39;ä¼˜åŒ–å&#39;</span><span class="p">:</span> <span class="mi">6000</span><span class="p">,</span>
                <span class="s1">&#39;æªæ–½&#39;</span><span class="p">:</span> <span class="s1">&#39;åˆ†å±‚è¯„ä¼°(60%) + ä¸»åŠ¨å­¦ä¹ (40%)&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;APIæˆæœ¬&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;åŸå§‹&#39;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
                <span class="s1">&#39;ä¼˜åŒ–å&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="s1">&#39;æªæ–½&#39;</span><span class="p">:</span> <span class="s1">&#39;å°æ¨¡å‹é¢„ç­›(80%) + ç¼“å­˜å¤ç”¨(20%)&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;æ€»è®¡&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;åŸå§‹&#39;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
                <span class="s1">&#39;ä¼˜åŒ–å&#39;</span><span class="p">:</span> <span class="mi">22000</span><span class="p">,</span>
                <span class="s1">&#39;èŠ‚çœ&#39;</span><span class="p">:</span> <span class="s1">&#39;56%&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">optimized_cost</span>

    <span class="k">def</span> <span class="nf">implementation_roadmap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        å®æ–½è·¯çº¿å›¾</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">roadmap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Week 1-2&#39;</span><span class="p">:</span> <span class="s1">&#39;å®ç°æ™ºèƒ½é‡‡æ ·å’Œç¼“å­˜æœºåˆ¶&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Week 3-4&#39;</span><span class="p">:</span> <span class="s1">&#39;éƒ¨ç½²åˆ†å±‚è¯„ä¼°æµç¨‹&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Week 5-6&#39;</span><span class="p">:</span> <span class="s1">&#39;é›†æˆè‡ªåŠ¨åŒ–é¢„ç­›é€‰&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Week 7-8&#39;</span><span class="p">:</span> <span class="s1">&#39;ä¼˜åŒ–èµ„æºè°ƒåº¦&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Week 9-10&#39;</span><span class="p">:</span> <span class="s1">&#39;A/B æµ‹è¯•éªŒè¯è¯„ä¼°è´¨é‡&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Week 11-12&#39;</span><span class="p">:</span> <span class="s1">&#39;å…¨é¢éƒ¨ç½²å’Œç›‘æ§&#39;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">roadmap</span>
</code></pre></div>

<p><strong>å…³é”®ä¼˜åŒ–ç‚¹ï¼š</strong></p>
<ol>
<li><strong>æ™ºèƒ½é‡‡æ ·</strong>ï¼šå‡å°‘ 40% æ ·æœ¬é‡</li>
<li><strong>è¯„ä¼°å¤ç”¨</strong>ï¼šèŠ‚çœ 60% é‡å¤å·¥ä½œ</li>
<li><strong>åˆ†å±‚æµç¨‹</strong>ï¼š70% æ¨¡å‹æå‰ç»ˆæ­¢</li>
<li><strong>æ··åˆè¯„ä¼°</strong>ï¼š80% API æˆæœ¬é™ä½</li>
<li><strong>èµ„æºä¼˜åŒ–</strong>ï¼š30% è®¡ç®—æˆæœ¬é™ä½</li>
</ol>
<p><strong>æ€»ä½“æ•ˆæœ</strong>ï¼šæˆæœ¬é™ä½ 56%ï¼Œè¯„ä¼°è´¨é‡ä¿æŒ 95% ä»¥ä¸Š</p>
</details>
<p><strong>ç»ƒä¹  7.8ï¼šè¯„ä¼°åè§æ£€æµ‹</strong></p>
<p>è®¾è®¡ä¸€ä¸ªæ–¹æ³•æ¥æ£€æµ‹ VLM è¯„ä¼°è¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨çš„åè§ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šæ–‡åŒ–åè§ã€è¯­è¨€åè§ã€è§†è§‰é£æ ¼åè§ç­‰ã€‚</p>
<p>ğŸ’¡ <strong>æç¤º</strong>ï¼šè€ƒè™‘å¦‚ä½•æ„é€ å¯¹ç…§å®éªŒã€‚</p>
<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>
<p>è¯„ä¼°åè§æ£€æµ‹æ¡†æ¶ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EvaluationBiasDetector</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_dimensions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;cultural&#39;</span><span class="p">,</span>
            <span class="s1">&#39;linguistic&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;visual_style&#39;</span><span class="p">,</span>
            <span class="s1">&#39;demographic&#39;</span><span class="p">,</span>
            <span class="s1">&#39;geographic&#39;</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">detect_cultural_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">evaluation_set</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æ£€æµ‹æ–‡åŒ–åè§</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># æ„é€ æ–‡åŒ–å¯¹ç…§ç»„</span>
        <span class="n">cultural_groups</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;western&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_western_content</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">),</span>
            <span class="s1">&#39;eastern&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_eastern_content</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">),</span>
            <span class="s1">&#39;african&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_african_content</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">),</span>
            <span class="s1">&#39;latin&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_latin_content</span><span class="p">(</span><span class="n">evaluation_set</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># è¯„ä¼°å„æ–‡åŒ–ç»„çš„è¡¨ç°</span>
        <span class="n">performance</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">culture</span><span class="p">,</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">cultural_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
            <span class="n">performance</span><span class="p">[</span><span class="n">culture</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;mean_score&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
                <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
                <span class="s1">&#39;n_samples&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="c1"># ç»Ÿè®¡åˆ†æåè§</span>
        <span class="n">bias_metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;performance_gap&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_score&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> 
                              <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_score&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="s1">&#39;fairness_score&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_score&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]),</span>
            <span class="s1">&#39;statistical_test&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">anova_test</span><span class="p">(</span><span class="n">performance</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">bias_metrics</span>

    <span class="k">def</span> <span class="nf">detect_linguistic_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æ£€æµ‹è¯­è¨€åè§</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># æ„é€ ç­‰ä»·çš„å¤šè¯­è¨€æµ‹è¯•é›†</span>
        <span class="n">test_cases</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ç›¸åŒå†…å®¹ï¼Œä¸åŒè¡¨è¾¾æ–¹å¼</span>
        <span class="n">expressions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;formal&#39;</span><span class="p">:</span> <span class="s2">&quot;The figure illustrates a declining trend&quot;</span><span class="p">,</span>
            <span class="s1">&#39;casual&#39;</span><span class="p">:</span> <span class="s2">&quot;The graph shows it&#39;s going down&quot;</span><span class="p">,</span>
            <span class="s1">&#39;technical&#39;</span><span class="p">:</span> <span class="s2">&quot;The plot exhibits negative correlation&quot;</span><span class="p">,</span>
            <span class="s1">&#39;simple&#39;</span><span class="p">:</span> <span class="s2">&quot;Numbers get smaller&quot;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">style</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">expressions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="n">test_cases</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="n">style</span><span class="p">,</span>
                <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">confidence</span>
            <span class="p">})</span>

        <span class="c1"># åˆ†æé£æ ¼åå¥½</span>
        <span class="n">style_bias</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;preferred_style&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">test_cases</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">])[</span><span class="s1">&#39;style&#39;</span><span class="p">],</span>
            <span class="s1">&#39;style_variance&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">([</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">test_cases</span><span class="p">]),</span>
            <span class="s1">&#39;consistency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_consistency</span><span class="p">(</span><span class="n">test_cases</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">style_bias</span>

    <span class="k">def</span> <span class="nf">detect_visual_style_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æ£€æµ‹è§†è§‰é£æ ¼åè§</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ç›¸åŒå†…å®¹ï¼Œä¸åŒè§†è§‰é£æ ¼</span>
        <span class="n">style_variants</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;photograph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_photo_dataset</span><span class="p">(),</span>
            <span class="s1">&#39;illustration&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_illustration_dataset</span><span class="p">(),</span>
            <span class="s1">&#39;sketch&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_sketch_dataset</span><span class="p">(),</span>
            <span class="s1">&#39;diagram&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_diagram_dataset</span><span class="p">(),</span>
            <span class="s1">&#39;screenshot&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_screenshot_dataset</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">performance_by_style</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">style</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">style_variants</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># ç¡®ä¿å†…å®¹ç­‰ä»·</span>
            <span class="n">controlled_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_controlled_set</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">controlled_set</span><span class="p">)</span>

            <span class="n">performance_by_style</span><span class="p">[</span><span class="n">style</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
                <span class="s1">&#39;error_types&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_errors</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">controlled_set</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="c1"># è®¡ç®—é£æ ¼åè§æŒ‡æ ‡</span>
        <span class="n">style_bias</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;max_gap&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_max_gap</span><span class="p">(</span><span class="n">performance_by_style</span><span class="p">),</span>
            <span class="s1">&#39;style_preference&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_preference</span><span class="p">(</span><span class="n">performance_by_style</span><span class="p">),</span>
            <span class="s1">&#39;robustness_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_robustness</span><span class="p">(</span><span class="n">performance_by_style</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">style_bias</span>

    <span class="k">def</span> <span class="nf">construct_counterfactual_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æ„é€ åäº‹å®æµ‹è¯•</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">counterfactuals</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># 1. æ€§åˆ«äº¤æ¢æµ‹è¯•</span>
        <span class="n">counterfactuals</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;original&#39;</span><span class="p">:</span> <span class="s2">&quot;ä¸€ä½ç”·åŒ»ç”Ÿåœ¨æ£€æŸ¥ç—…äºº&quot;</span><span class="p">,</span>
            <span class="s1">&#39;counterfactual&#39;</span><span class="p">:</span> <span class="s2">&quot;ä¸€ä½å¥³åŒ»ç”Ÿåœ¨æ£€æŸ¥ç—…äºº&quot;</span><span class="p">,</span>
            <span class="s1">&#39;attribute&#39;</span><span class="p">:</span> <span class="s1">&#39;gender&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expected_difference&#39;</span><span class="p">:</span> <span class="mi">0</span>  <span class="c1"># æœŸæœ›æ— å·®å¼‚</span>
        <span class="p">})</span>

        <span class="c1"># 2. ç§æ—äº¤æ¢æµ‹è¯•</span>
        <span class="n">counterfactuals</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;original_image&#39;</span><span class="p">:</span> <span class="s2">&quot;asian_person_coding.jpg&quot;</span><span class="p">,</span>
            <span class="s1">&#39;counterfactual_image&#39;</span><span class="p">:</span> <span class="s2">&quot;african_person_coding.jpg&quot;</span><span class="p">,</span>
            <span class="s1">&#39;attribute&#39;</span><span class="p">:</span> <span class="s1">&#39;race&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expected_difference&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">})</span>

        <span class="c1"># 3. å¹´é¾„äº¤æ¢æµ‹è¯•</span>
        <span class="n">counterfactuals</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;original&#39;</span><span class="p">:</span> <span class="s2">&quot;å¹´è½»äººä½¿ç”¨æ™ºèƒ½æ‰‹æœº&quot;</span><span class="p">,</span>
            <span class="s1">&#39;counterfactual&#39;</span><span class="p">:</span> <span class="s2">&quot;è€å¹´äººä½¿ç”¨æ™ºèƒ½æ‰‹æœº&quot;</span><span class="p">,</span>
            <span class="s1">&#39;attribute&#39;</span><span class="p">:</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expected_difference&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">counterfactuals</span>

    <span class="k">def</span> <span class="nf">measure_intersectional_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">evaluation_set</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æµ‹é‡äº¤å‰æ€§åè§</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># å¤šç»´åº¦ç»„åˆ</span>
        <span class="n">intersections</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;gender_x_race&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;age_x_culture&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;style_x_language&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># åˆ†æå¤šç»´åº¦äº¤å‰çš„å½±å“</span>
        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">evaluation_set</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_attributes</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>

            <span class="c1"># è®°å½•äº¤å‰å±æ€§ç»„åˆçš„è¡¨ç°</span>
            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">intersections</span><span class="p">[</span><span class="s1">&#39;gender_x_race&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">score</span><span class="p">))</span>

        <span class="c1"># è®¡ç®—äº¤å‰åè§</span>
        <span class="n">intersectional_bias</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">dimension</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">intersections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">grouped</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">grouped</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

            <span class="c1"># è®¡ç®—å„ç»„åˆçš„å¹³å‡è¡¨ç°</span>
            <span class="n">means</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">grouped</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">intersectional_bias</span><span class="p">[</span><span class="n">dimension</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;group_means&#39;</span><span class="p">:</span> <span class="n">means</span><span class="p">,</span>
                <span class="s1">&#39;max_gap&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">means</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">means</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                <span class="s1">&#39;most_disadvantaged&#39;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">means</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">intersectional_bias</span>

    <span class="k">def</span> <span class="nf">generate_bias_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_metrics</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ç”Ÿæˆåè§è¯„ä¼°æŠ¥å‘Š</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;overall_fairness_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_overall_fairness</span><span class="p">(</span><span class="n">all_metrics</span><span class="p">),</span>
                <span class="s1">&#39;main_bias_sources&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_main_biases</span><span class="p">(</span><span class="n">all_metrics</span><span class="p">),</span>
                <span class="s1">&#39;recommendations&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_recommendations</span><span class="p">(</span><span class="n">all_metrics</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s1">&#39;detailed_findings&#39;</span><span class="p">:</span> <span class="n">all_metrics</span><span class="p">,</span>
            <span class="s1">&#39;mitigation_strategies&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;data_balancing&#39;</span><span class="p">:</span> <span class="s1">&#39;å¢åŠ ä»£è¡¨æ€§ä¸è¶³ç¾¤ä½“çš„è®­ç»ƒæ•°æ®&#39;</span><span class="p">,</span>
                <span class="s1">&#39;debiasing_techniques&#39;</span><span class="p">:</span> <span class="s1">&#39;åº”ç”¨å¯¹æŠ—æ€§å»åæˆ–å…¬å¹³æ€§çº¦æŸ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;evaluation_improvement&#39;</span><span class="p">:</span> <span class="s1">&#39;ä½¿ç”¨æ›´å¹³è¡¡çš„è¯„ä¼°é›†&#39;</span><span class="p">,</span>
                <span class="s1">&#39;human_review&#39;</span><span class="p">:</span> <span class="s1">&#39;å¯¹è¯†åˆ«å‡ºçš„åè§æ¡ˆä¾‹è¿›è¡Œäººå·¥å®¡æ ¸&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">report</span>
</code></pre></div>

<p><strong>åè§æ£€æµ‹ç»´åº¦ï¼š</strong></p>
<ol>
<li><strong>æ–‡åŒ–åè§</strong>ï¼šä¸åŒæ–‡åŒ–èƒŒæ™¯å†…å®¹çš„æ€§èƒ½å·®å¼‚</li>
<li><strong>è¯­è¨€åè§</strong>ï¼šå¯¹ç‰¹å®šè¯­è¨€é£æ ¼æˆ–æ–¹è¨€çš„åå¥½</li>
<li><strong>è§†è§‰é£æ ¼åè§</strong>ï¼šå¯¹ç‰¹å®šå›¾åƒç±»å‹çš„åå¥½</li>
<li><strong>äººå£ç»Ÿè®¡åè§</strong>ï¼šåŸºäºæ€§åˆ«ã€å¹´é¾„ã€ç§æ—çš„å·®å¼‚</li>
<li><strong>äº¤å‰æ€§åè§</strong>ï¼šå¤šä¸ªå±æ€§ç»„åˆäº§ç”Ÿçš„å¤åˆåè§</li>
</ol>
<p><strong>å…³é”®æ–¹æ³•ï¼š</strong></p>
<ul>
<li>åäº‹å®æµ‹è¯•ï¼šæ”¹å˜å•ä¸€å±æ€§è§‚å¯Ÿå½±å“</li>
<li>åˆ†å±‚åˆ†æï¼šæŒ‰ä¸åŒç»´åº¦åˆ†ç»„æ¯”è¾ƒ</li>
<li>ç»Ÿè®¡æ£€éªŒï¼šç¡®å®šå·®å¼‚çš„æ˜¾è‘—æ€§</li>
<li>äº¤å‰åˆ†æï¼šè¯†åˆ«å¤åˆåè§æ¨¡å¼</li>
</ul>
</details>
<h2 id="79">7.9 å¸¸è§é™·é˜±ä¸é”™è¯¯</h2>
<h3 id="1">é™·é˜± 1ï¼šè¿‡åº¦ä¾èµ–å•ä¸€æŒ‡æ ‡</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼š
åªçœ‹ accuracy æˆ– BLEU åˆ†æ•°å°±å†³å®šæ¨¡å‹å¥½åï¼Œå¿½ç•¥å…¶ä»–é‡è¦ç»´åº¦ã€‚</p>
<p><strong>åæœ</strong>ï¼š</p>
<ul>
<li>æ¨¡å‹å¯èƒ½åœ¨å‡†ç¡®ç‡é«˜ä½†ç”¨æˆ·ä½“éªŒå·®</li>
<li>å¿½ç•¥äº†å®‰å…¨æ€§ã€å…¬å¹³æ€§ç­‰å…³é”®é—®é¢˜</li>
<li>æ— æ³•å‘ç°ç‰¹å®šåœºæ™¯ä¸‹çš„å¤±è´¥æ¨¡å¼</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># âŒ é”™è¯¯åšæ³•</span>
<span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">:</span>
    <span class="n">deploy_model</span><span class="p">()</span>

<span class="c1"># âœ… æ­£ç¡®åšæ³•</span>
<span class="n">evaluation_criteria</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span>
    <span class="s1">&#39;latency_p99&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span>  <span class="c1"># ms</span>
    <span class="s1">&#39;hallucination_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span>
    <span class="s1">&#39;fairness_gap&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span>
    <span class="s1">&#39;user_satisfaction&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">)</span>  <span class="c1"># 1-5 scale</span>
<span class="p">}</span>

<span class="n">all_pass</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
    <span class="n">check_criterion</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span> <span class="ow">in</span> <span class="n">evaluation_criteria</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">all_pass</span><span class="p">:</span>
    <span class="n">deploy_model</span><span class="p">()</span>
</code></pre></div>

<h3 id="2">é™·é˜± 2ï¼šè¯„ä¼°æ•°æ®æ³„éœ²</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼š
æµ‹è¯•é›†æ•°æ®æ„å¤–å‡ºç°åœ¨è®­ç»ƒé›†ä¸­ï¼Œå¯¼è‡´è¯„ä¼°ç»“æœè™šé«˜ã€‚</p>
<p><strong>å¸¸è§æ¥æº</strong>ï¼š</p>
<ul>
<li>ç½‘ç»œçˆ¬å–çš„æ•°æ®åŒ…å«äº†å…¬å¼€çš„æµ‹è¯•é›†</li>
<li>æ•°æ®å¢å¼ºæ—¶ä¸å°å¿ƒä½¿ç”¨äº†æµ‹è¯•å›¾åƒ</li>
<li>ä½¿ç”¨äº†åŒ…å«æµ‹è¯•é›†çš„é¢„è®­ç»ƒæ¨¡å‹</li>
</ul>
<p><strong>æ£€æµ‹æ–¹æ³•</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># æ•°æ®æ³„éœ²æ£€æµ‹</span>
<span class="k">def</span> <span class="nf">detect_leakage</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">):</span>
    <span class="c1"># 1. ç²¾ç¡®åŒ¹é…æ£€æµ‹</span>
    <span class="n">train_hashes</span> <span class="o">=</span> <span class="p">{</span><span class="nb">hash</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">train_data</span><span class="o">.</span><span class="n">images</span><span class="p">}</span>
    <span class="n">test_hashes</span> <span class="o">=</span> <span class="p">{</span><span class="nb">hash</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">test_data</span><span class="o">.</span><span class="n">images</span><span class="p">}</span>
    <span class="n">exact_overlap</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_hashes</span> <span class="o">&amp;</span> <span class="n">test_hashes</span><span class="p">)</span>

    <span class="c1"># 2. è¿‘ä¼¼åŒ¹é…æ£€æµ‹ï¼ˆä½¿ç”¨æ„ŸçŸ¥å“ˆå¸Œï¼‰</span>
    <span class="n">train_phash</span> <span class="o">=</span> <span class="p">{</span><span class="n">imagehash</span><span class="o">.</span><span class="n">phash</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">train_data</span><span class="o">.</span><span class="n">images</span><span class="p">}</span>
    <span class="n">test_phash</span> <span class="o">=</span> <span class="p">{</span><span class="n">imagehash</span><span class="o">.</span><span class="n">phash</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">test_data</span><span class="o">.</span><span class="n">images</span><span class="p">}</span>

    <span class="n">near_duplicates</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">test_h</span> <span class="ow">in</span> <span class="n">test_phash</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">train_h</span> <span class="ow">in</span> <span class="n">train_phash</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">test_h</span> <span class="o">-</span> <span class="n">train_h</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># æ±‰æ˜è·ç¦»é˜ˆå€¼</span>
                <span class="n">near_duplicates</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">break</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ç²¾ç¡®é‡å¤: </span><span class="si">{</span><span class="n">exact_overlap</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;è¿‘ä¼¼é‡å¤: </span><span class="si">{</span><span class="n">near_duplicates</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;æ³„éœ²ç‡: </span><span class="si">{</span><span class="p">(</span><span class="n">exact_overlap</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">near_duplicates</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="3">é™·é˜± 3ï¼šå¿½è§†ç½®ä¿¡åŒºé—´</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼š
åªæŠ¥å‘Šç‚¹ä¼°è®¡ï¼Œä¸è®¡ç®—ç½®ä¿¡åŒºé—´ï¼Œå¯¼è‡´æ— æ³•åˆ¤æ–­ç»“æœçš„å¯é æ€§ã€‚</p>
<p><strong>æ­£ç¡®åšæ³•</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Bootstrap ç½®ä¿¡åŒºé—´</span>
<span class="k">def</span> <span class="nf">calculate_confidence_interval</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">bootstrap_means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstrap</span><span class="p">):</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bootstrap_means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>

    <span class="n">ci_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bootstrap_means</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">ci_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bootstrap_means</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
        <span class="s1">&#39;ci_95&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">ci_lower</span><span class="p">,</span> <span class="n">ci_upper</span><span class="p">),</span>
        <span class="s1">&#39;std_error&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">bootstrap_means</span><span class="p">)</span>
    <span class="p">}</span>

<span class="c1"># æŠ¥å‘Šæ ¼å¼</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">calculate_confidence_interval</span><span class="p">(</span><span class="n">model_scores</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;å‡†ç¡®ç‡: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (95% CI: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ci_95&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ci_95&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="4ab">é™·é˜± 4ï¼šA/B æµ‹è¯•è¿‡æ—©åœæ­¢</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼š
çœ‹åˆ°åˆæœŸçš„æ­£å‘ç»“æœå°±æ€¥äºå…¨é‡å‘å¸ƒï¼Œå¿½ç•¥äº†ç»Ÿè®¡åŠŸæ•ˆä¸è¶³çš„é—®é¢˜ã€‚</p>
<p><strong>åæœ</strong>ï¼š</p>
<ul>
<li>å‡é˜³æ€§ï¼šå®é™…æ— æ•ˆæœä½†åˆ¤æ–­ä¸ºæœ‰æ•ˆ</li>
<li>é”™è¿‡è´Ÿé¢å½±å“ï¼šåˆæœŸæœªæ˜¾ç°çš„é—®é¢˜</li>
<li>å†³ç­–ä¸ç¨³å®šï¼šç»“æœå¯èƒ½åè½¬</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># è®¾ç½®åˆç†çš„åœæ­¢æ ‡å‡†</span>
<span class="k">class</span> <span class="nc">ABTestStoppingCriteria</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_sample_size</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_test_days</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">required_power</span> <span class="o">=</span> <span class="mf">0.8</span>

    <span class="k">def</span> <span class="nf">should_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_stats</span><span class="p">):</span>
        <span class="c1"># æ£€æŸ¥å¤šä¸ªæ¡ä»¶</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;sample_size&#39;</span><span class="p">:</span> <span class="n">test_stats</span><span class="o">.</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_sample_size</span><span class="p">,</span>
            <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">test_stats</span><span class="o">.</span><span class="n">days</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_test_days</span><span class="p">,</span>
            <span class="s1">&#39;statistical_power&#39;</span><span class="p">:</span> <span class="n">test_stats</span><span class="o">.</span><span class="n">power</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_power</span><span class="p">,</span>
            <span class="s1">&#39;significance&#39;</span><span class="p">:</span> <span class="n">test_stats</span><span class="o">.</span><span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span>
        <span class="p">}</span>

        <span class="c1"># åªæœ‰æ‰€æœ‰æ¡ä»¶æ»¡è¶³æ‰èƒ½åœæ­¢</span>
        <span class="n">can_stop</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">conditions</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">can_stop</span><span class="p">,</span> <span class="n">conditions</span>
</code></pre></div>

<h3 id="5">é™·é˜± 5ï¼šäººå·¥è¯„ä¼°æ ‡å‡†ä¸ä¸€è‡´</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼š
ä¸åŒæ ‡æ³¨è€…ç†è§£ä¸åŒï¼Œæˆ–åŒä¸€æ ‡æ³¨è€…åœ¨ä¸åŒæ—¶é—´æ ‡å‡†å‘ç”Ÿæ¼‚ç§»ã€‚</p>
<p><strong>è¡¨ç°</strong>ï¼š</p>
<ul>
<li>Kappa ç³»æ•°ä½äº 0.4</li>
<li>ç›¸åŒæ ·æœ¬é‡å¤æ ‡æ³¨ç»“æœä¸ä¸€è‡´</li>
<li>æ ‡æ³¨è´¨é‡éšæ—¶é—´ä¸‹é™</li>
</ul>
<p><strong>é¢„é˜²æªæ–½</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AnnotationQualityController</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gold_standards</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># é»„é‡‘æ ‡å‡†æ ·æœ¬</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotator_history</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_quality_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_batch</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ’å…¥è´¨é‡æ£€æŸ¥æ ·æœ¬&quot;&quot;&quot;</span>
        <span class="c1"># æ¯ 10 ä¸ªä»»åŠ¡æ’å…¥ 1 ä¸ªé»„é‡‘æ ‡å‡†</span>
        <span class="n">mixed_batch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">task_batch</span><span class="p">):</span>
            <span class="n">mixed_batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">gold</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gold_standards</span><span class="p">)</span>
                <span class="n">mixed_batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gold</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mixed_batch</span>

    <span class="k">def</span> <span class="nf">monitor_annotator_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotator_id</span><span class="p">,</span> <span class="n">annotations</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç›‘æ§æ ‡æ³¨è€…è´¨é‡&quot;&quot;&quot;</span>
        <span class="n">gold_performance</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ann</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ann</span><span class="o">.</span><span class="n">is_gold_standard</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_agreement</span><span class="p">(</span><span class="n">ann</span><span class="p">,</span> <span class="n">ann</span><span class="o">.</span><span class="n">gold_answer</span><span class="p">)</span>
                <span class="n">gold_performance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">annotator_history</span><span class="p">[</span><span class="n">annotator_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                    <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span>
                <span class="p">})</span>

        <span class="c1"># æ£€æµ‹è´¨é‡ä¸‹é™</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gold_performance</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">recent_quality</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gold_performance</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">recent_quality</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alert</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;æ ‡æ³¨è€… </span><span class="si">{</span><span class="n">annotator_id</span><span class="si">}</span><span class="s2"> è´¨é‡ä¸‹é™åˆ° </span><span class="si">{</span><span class="n">recent_quality</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trigger_retraining</span><span class="p">(</span><span class="n">annotator_id</span><span class="p">)</span>
</code></pre></div>

<h3 id="6">é™·é˜± 6ï¼šå¿½ç•¥è¾¹ç•Œæ¡ä»¶</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼š
åªåœ¨å¸¸è§„è¾“å…¥ä¸Šè¯„ä¼°ï¼Œå¿½ç•¥è¾¹ç•Œå’Œå¼‚å¸¸æƒ…å†µã€‚</p>
<p><strong>å®¹æ˜“å¿½ç•¥çš„è¾¹ç•Œæ¡ä»¶</strong>ï¼š</p>
<ul>
<li>ç©ºè¾“å…¥ / çº¯ç™½å›¾åƒ</li>
<li>æé•¿æ–‡æœ¬è¾“å…¥</li>
<li>ç‰¹æ®Šå­—ç¬¦å’Œè¡¨æƒ…ç¬¦å·</li>
<li>ä½è´¨é‡ / æ¨¡ç³Šå›¾åƒ</li>
<li>æç«¯å®½é«˜æ¯”çš„å›¾åƒ</li>
</ul>
<p><strong>å…¨é¢æµ‹è¯•</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">create_edge_case_tests</span><span class="p">():</span>
    <span class="n">edge_cases</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ç©ºå›¾åƒ&#39;</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span>
            <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="s1">&#39;æè¿°è¿™å¼ å›¾ç‰‡&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expected_behavior&#39;</span><span class="p">:</span> <span class="s1">&#39;åˆç†å¤„ç†ï¼Œä¸å´©æºƒ&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;è¶…é•¿è¾“å…¥&#39;</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">normal_image</span><span class="p">,</span>
            <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">,</span>
            <span class="s1">&#39;expected_behavior&#39;</span><span class="p">:</span> <span class="s1">&#39;æˆªæ–­æˆ–æ‹’ç»ï¼Œä¸OOM&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ç‰¹æ®Šå­—ç¬¦&#39;</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">normal_image</span><span class="p">,</span>
            <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="s1">&#39;ï¿½ï¿½ï¿½è¿™æ˜¯ä»€ä¹ˆï¼ŸğŸ¤”&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expected_behavior&#39;</span><span class="p">:</span> <span class="s1">&#39;æ­£ç¡®è§£æï¼Œä¸æŠ¥é”™&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;æç«¯å®½é«˜æ¯”&#39;</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="s1">&#39;è¿™æ˜¯ä»€ä¹ˆå½¢çŠ¶ï¼Ÿ&#39;</span><span class="p">,</span>
            <span class="s1">&#39;expected_behavior&#39;</span><span class="p">:</span> <span class="s1">&#39;æ­£ç¡®å¤„ç†æˆ–ä¼˜é›…æ‹’ç»&#39;</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">edge_cases</span>
</code></pre></div>

<h2 id="710">7.10 æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•</h2>
<h3 id="_3">è¯„ä¼°è®¾è®¡é˜¶æ®µ</h3>
<ul>
<li>[ ] <strong>æ˜ç¡®è¯„ä¼°ç›®æ ‡</strong></li>
<li>[ ] å®šä¹‰æˆåŠŸæ ‡å‡†</li>
<li>[ ] ç¡®å®šå…³é”®æŒ‡æ ‡</li>
<li>
<p>[ ] è®¾ç½®å†³ç­–é˜ˆå€¼</p>
</li>
<li>
<p>[ ] <strong>é€‰æ‹©è¯„ä¼°æ–¹æ³•</strong></p>
</li>
<li>[ ] é€‰æ‹© 3-5 ä¸ªäº’è¡¥çš„åŸºå‡†æµ‹è¯•</li>
<li>[ ] è®¾è®¡ä»»åŠ¡ç‰¹å®šçš„è¯„ä¼°</li>
<li>
<p>[ ] è§„åˆ’äººå·¥è¯„ä¼°æ¯”ä¾‹</p>
</li>
<li>
<p>[ ] <strong>æ•°æ®è´¨é‡ä¿è¯</strong></p>
</li>
<li>[ ] æ£€æŸ¥æµ‹è¯•é›†ä»£è¡¨æ€§</li>
<li>[ ] éªŒè¯æ— æ•°æ®æ³„éœ²</li>
<li>[ ] å‡†å¤‡è¾¹ç•Œæ¡ä»¶æµ‹è¯•</li>
</ul>
<h3 id="_4">è¯„ä¼°æ‰§è¡Œé˜¶æ®µ</h3>
<ul>
<li>[ ] <strong>è‡ªåŠ¨è¯„ä¼°</strong></li>
<li>[ ] è¿è¡ŒåŸºå‡†æµ‹è¯•</li>
<li>[ ] è®¡ç®—å¤šç»´åº¦æŒ‡æ ‡</li>
<li>
<p>[ ] ç”Ÿæˆç½®ä¿¡åŒºé—´</p>
</li>
<li>
<p>[ ] <strong>äººå·¥è¯„ä¼°</strong></p>
</li>
<li>[ ] åˆ¶å®šæ¸…æ™°çš„æ ‡æ³¨æŒ‡å—</li>
<li>[ ] åŸ¹è®­æ ‡æ³¨è€…</li>
<li>[ ] æ’å…¥è´¨é‡æ£€æŸ¥ç‚¹</li>
<li>
<p>[ ] è®¡ç®—ä¸€è‡´æ€§æŒ‡æ ‡</p>
</li>
<li>
<p>[ ] <strong>åœ¨çº¿è¯„ä¼°</strong></p>
</li>
<li>[ ] è®¾ç½®æŠ¤æ æŒ‡æ ‡</li>
<li>[ ] å®æ–½æ¸è¿›å¼å‘å¸ƒ</li>
<li>[ ] ç›‘æ§å®æ—¶æŒ‡æ ‡</li>
<li>[ ] å‡†å¤‡å›æ»šæ–¹æ¡ˆ</li>
</ul>
<h3 id="_5">åˆ†æä¸å†³ç­–é˜¶æ®µ</h3>
<ul>
<li>[ ] <strong>ç»“æœåˆ†æ</strong></li>
<li>[ ] è¿›è¡Œç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ</li>
<li>[ ] åˆ†æå¤±è´¥æ¡ˆä¾‹</li>
<li>[ ] è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ</li>
<li>
<p>[ ] æ£€æŸ¥åè§å’Œå…¬å¹³æ€§</p>
</li>
<li>
<p>[ ] <strong>æŠ¥å‘Šç”Ÿæˆ</strong></p>
</li>
<li>[ ] æ±‡æ€»å…³é”®å‘ç°</li>
<li>[ ] å¯è§†åŒ–ç»“æœ</li>
<li>[ ] æä¾›æ”¹è¿›å»ºè®®</li>
<li>
<p>[ ] è®°å½•å·²çŸ¥é™åˆ¶</p>
</li>
<li>
<p>[ ] <strong>å†³ç­–æ”¯æŒ</strong></p>
</li>
<li>[ ] å¯¹æ¯”åŸºçº¿æ¨¡å‹</li>
<li>[ ] è¯„ä¼°é£é™©æ”¶ç›Š</li>
<li>[ ] åˆ¶å®šå‘å¸ƒè®¡åˆ’</li>
<li>[ ] è®¾ç½®ç›‘æ§é¢„è­¦</li>
</ul>
<h3 id="_6">æŒç»­æ”¹è¿›</h3>
<ul>
<li>[ ] <strong>è¯„ä¼°ä½“ç³»ä¼˜åŒ–</strong></li>
<li>[ ] æ”¶é›†è¯„ä¼°åé¦ˆ</li>
<li>[ ] æ›´æ–°æµ‹è¯•é›†</li>
<li>[ ] ä¼˜åŒ–è¯„ä¼°æ•ˆç‡</li>
<li>
<p>[ ] é™ä½è¯„ä¼°æˆæœ¬</p>
</li>
<li>
<p>[ ] <strong>çŸ¥è¯†ç§¯ç´¯</strong></p>
</li>
<li>[ ] è®°å½•ç»éªŒæ•™è®­</li>
<li>[ ] ç»´æŠ¤è¯„ä¼°çŸ¥è¯†åº“</li>
<li>[ ] åˆ†äº«æœ€ä½³å®è·µ</li>
<li>[ ] åŸ¹è®­å›¢é˜Ÿæˆå‘˜</li>
</ul>
<h3 id="_7">ğŸš¨ çº¢çº¿æ ‡å‡†</h3>
<p><strong>ç»å¯¹ä¸èƒ½å¦¥åçš„æ ‡å‡†ï¼š</strong></p>
<ol>
<li><strong>æ•°æ®æ³„éœ²é›¶å®¹å¿</strong>ï¼šå‘ç°ä»»ä½•æ³„éœ²ç«‹å³åœæ­¢è¯„ä¼°</li>
<li><strong>ç»Ÿè®¡æ˜¾è‘—æ€§è¦æ±‚</strong>ï¼šp &lt; 0.05 ä¸”åŠŸæ•ˆ &gt; 0.8</li>
<li><strong>å®‰å…¨æ€§ä¼˜å…ˆ</strong>ï¼šä»»ä½•å®‰å…¨æŒ‡æ ‡é€€åŒ–éƒ½ä¸èƒ½å‘å¸ƒ</li>
<li><strong>ç”¨æˆ·ä½“éªŒä¿æŠ¤</strong>ï¼šæ ¸å¿ƒä½“éªŒæŒ‡æ ‡ä¸èƒ½é€€åŒ–è¶…è¿‡ 1%</li>
<li><strong>å…¬å¹³æ€§ä¿è¯</strong>ï¼šä¸åŒç¾¤ä½“æ€§èƒ½å·®è· &lt; 10%</li>
</ol>
            </article>
            
            <nav class="page-nav"><a href="chapter6.html" class="nav-link prev">â† ç¬¬ 6 ç« ï¼šç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDPOï¼‰</a><a href="chapter8.html" class="nav-link next">ç¬¬ 8 ç« ï¼šæ¨¡å‹éƒ¨ç½²ä¸æœåŠ¡åŒ– â†’</a></nav>
        </main>
    </div>
</body>
</html>